import openai
from flask import Flask, render_template, request, jsonify, session
from dotenv import load_dotenv
from datetime import datetime
import os
import random
import re
import smtplib
from email.mime.text import MIMEText
from flask_session import Session

app = Flask(__name__)

app.config['SESSION_TYPE'] = 'filesystem'  # Ð—Ð±ÐµÑ€Ñ–Ð³Ð°Ñ”Ð¼Ð¾ ÑÐµÑÑ–Ñ— Ð½Ð° Ñ„Ð°Ð¹Ð»Ð¾Ð²Ñ–Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ–
app.config['SESSION_PERMANENT'] = False
app.config['SESSION_USE_SIGNER'] = True
Session(app)

load_dotenv()

app.secret_key = os.getenv("FLASK_SECRET_KEY", "Ð²Ñ–Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¸Ð¹ÐºÐ»Ñ–Ñ”Ð½Ñ‚")
openai.api_key = os.getenv("OPENAI_API_KEY")
MODEL_ENGINE = "gpt-3.5-turbo"

SITUATIONS = [
    {
        "id": 1,
        "description": "ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚ Ð´Ð»Ñ Ð·Ð±Ñ–Ñ€ÐºÐ¸ Ð¼ÐµÐ±Ð»Ñ–Ð²",
        "requirements": "Ð»ÐµÐ³ÐºÐ¸Ð¹, Ð·Ñ€ÑƒÑ‡Ð½Ð¸Ð¹ ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚ Ð· Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾ÑŽ ÐµÑ€Ð³Ð¾Ð½Ð¾Ð¼Ñ–ÐºÐ¾ÑŽ Ð´Ð»Ñ Ñ‚Ñ€Ð¸Ð²Ð°Ð»Ð¾Ñ— Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸",
        "avatar": "id13.png",
        "behavior": "ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ñ– Ñ‚Ð²ÐµÑ€Ð´Ð¶ÐµÐ½Ð½Ñ",
        "correct_models": ["CD-12QX", "CD-12CX", "CD-12BC"],
        "wrong_models": ["CD-200BCULTRA", "CD-201HBC", "CD-218Q", "CD-200BCCOMPACT"],
        "hints": [
        "ÐœÐµÐ½Ñ– Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ ÑÐ°Ð¼Ðµ 12V ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚",
        "Ð—Ð±Ð¸Ñ€Ð°ÑŽ ÑˆÐ°Ñ„Ð¸ Ð¹ ÐºÑƒÑ…Ð½Ñ–, Ñ‡Ð°ÑÑ‚Ð¾ Ð¿Ñ€ÑÐ¼Ð¾ Ñƒ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°",
        "Ð¢Ñ€Ð¸Ð¼Ð°ÑŽ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ Ñƒ Ñ€ÑƒÐºÐ°Ñ… Ð¿Ð¾ ÐºÑ–Ð»ÑŒÐºÐ° Ð³Ð¾Ð´Ð¸Ð½",
        "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¾, Ñ‰Ð¾Ð± Ñ€ÑƒÐºÐ° Ð½Ðµ Ð²Ñ‚Ð¾Ð¼Ð»ÑŽÐ²Ð°Ð»Ð°ÑÑ",
        "ÐšÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚ Ð²Ð°Ð¶Ð»Ð¸Ð²Ñ–ÑˆÐ¸Ð¹ Ð·Ð° Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑÑ‚ÑŒ"
        ]
    },
    {
        "id": 2,
        "description": "ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚ Ð´Ð»Ñ Ð´Ð¾Ð¼Ð°ÑˆÐ½ÑŒÐ¾Ð³Ð¾ Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ñƒ",
        "requirements": "Ð½ÐµÐ´Ð¾Ñ€Ð¾Ð³Ð¸Ð¹ Ñ‚Ð° ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð¸Ð¹ ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚ Ð´Ð»Ñ Ð¿Ð¾Ð±ÑƒÑ‚Ð¾Ð²Ð¸Ñ… Ð·Ð°Ð´Ð°Ñ‡",
        "avatar": "id8.png",
        "behavior": "Ð°Ð³Ñ€ÐµÑÐ¸Ð²Ð½Ð¾ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ñ”",
        "correct_models": ["CD-12QX", "CD-12CX", "CD-12BC"],
        "wrong_models": ["CD-200BCULTRA", "CD-201HBC", "CD-218Q", "CD-200BCCOMPACT"],
        "hints": [
        "Ð¨ÑƒÐºÐ°ÑŽ 12V ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚ Ð´Ð»Ñ Ð´Ð¾Ð¼Ñƒ",
        "Ð†Ð½Ð¾Ð´Ñ– Ñ‚Ñ€ÐµÐ±Ð° Ð¿Ð¾Ð²Ñ–ÑÐ¸Ñ‚Ð¸ Ð¿Ð¾Ð»Ð¸Ñ†ÑŽ Ð°Ð±Ð¾ Ð·Ñ–Ð±Ñ€Ð°Ñ‚Ð¸ ÐºÐ¾Ð¼Ð¾Ð´",
        "ÐÐµ Ñ…Ð¾Ñ‡Ñƒ Ð¿ÐµÑ€ÐµÐ¿Ð»Ð°Ñ‡ÑƒÐ²Ð°Ñ‚Ð¸ Ð·Ð° Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑÑ‚ÑŒ",
        "Ð¦Ñ–Ð½ÑƒÑŽ ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ñ–ÑÑ‚ÑŒ Ñ– Ð·Ñ€ÑƒÑ‡Ð½Ñ–ÑÑ‚ÑŒ",
        "Ð‘ÑŽÐ´Ð¶ÐµÑ‚ Ð´Ð¾ 2000 Ð³Ñ€Ð½"
        ]
    },
    {
        "id": 3,
        "description": "Ð¿Ð¾Ð´Ð°Ñ€ÑƒÐ½Ð¾Ðº Ñ‚Ð°Ñ‚Ð¾Ð²Ñ– â€“ ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚",
        "requirements": "ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð¸Ð¹, Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ð¹ Ñƒ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ– ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚ Ð´Ð»Ñ Ð±Ð°Ð·Ð¾Ð²Ð¸Ñ… Ñ€Ð¾Ð±Ñ–Ñ‚",
        "avatar": "id9.png",
        "behavior": "ÑÐ¿Ð¾ÐºÑ–Ð¹Ð½Ð¾ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ñ”",
        "correct_models": ["CD-12QX", "CD-12CX", "CD-12BC"],
        "wrong_models": ["CD-200BCULTRA", "CD-201HBC", "CD-218Q", "CD-200BCCOMPACT"],
        "hints": [
        "Ð¨ÑƒÐºÐ°ÑŽ 12V ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚ ÑÐº Ð¿Ð¾Ð´Ð°Ñ€ÑƒÐ½Ð¾Ðº",
        "Ð‘Ð°Ñ‚ÑŒÐºÐ¾ Ñ–Ð½Ð¾Ð´Ñ– Ñ‰Ð¾ÑÑŒ Ð¿Ñ–Ð´ÐºÑ€ÑƒÑ‡ÑƒÑ” Ð²Ð´Ð¾Ð¼Ð° Ð°Ð±Ð¾ Ð² Ð³Ð°Ñ€Ð°Ð¶Ñ–",
        "Ð™Ð¾Ð¼Ñƒ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ð¹ Ñ‚Ð° Ð½Ð°Ð´Ñ–Ð¹Ð½Ð¸Ð¹ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚",
        "Ð‘ÐµÐ· ÑÐºÐ»Ð°Ð´Ð½Ð¸Ñ… Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½ÑŒ",
        "Ð“Ð¾Ð»Ð¾Ð²Ð½Ðµ â€” Ñ‰Ð¾Ð± Ð±ÑƒÐ² Ð»ÐµÐ³ÐºÐ¸Ð¹ Ñ– Ð·Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ð»Ð¸Ð¹"
        ]
    },
    {
        "id": 4,
        "description": "ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚ Ð´Ð»Ñ Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ñƒ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ñ–ÐºÐ¸, Ñ€Ð¾Ð±Ð¾Ñ‚Ð° Ð· Ð´Ñ€Ñ–Ð±Ð½Ð¸Ð¼Ð¸ ÐºÑ€Ñ–Ð¿Ð»ÐµÐ½Ð½ÑÐ¼Ð¸ ",
        "requirements": "Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¸Ð¹ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ð¾Ð±ÐµÑ€Ñ‚Ñ–Ð² Ñ– Ñ‚Ð¾Ñ‡Ð½Ñ–ÑÑ‚ÑŒ",
        "avatar": "id3.png",
        "behavior": "Ð»ÑŽÐ±Ð¸Ñ‚ÑŒ Ð¶Ð°Ñ€Ñ‚Ð¸",
        "correct_models": ["CD-12QX", "CD-12CX", "CD-12BC", "CD-218Q"],
        "wrong_models": ["CD-200BCULTRA", "CD-201HBC", "CD-200BCCOMPACT"],
        "hints": [
        "ÐœÐµÐ½Ñ– Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ 12V ÑˆÑƒÑ€ÑƒÐ¿Ð¾Ð²ÐµÑ€Ñ‚",
        "ÐŸÑ€Ð°Ñ†ÑŽÑŽ Ð· Ð´Ñ€Ñ–Ð±Ð½Ð¸Ð¼Ð¸ Ð³Ð²Ð¸Ð½Ñ‚Ð°Ð¼Ð¸ Ð¹ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ñ–ÐºÐ¾ÑŽ",
        "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð° Ñ‚Ð¾Ñ‡Ð½Ñ–ÑÑ‚ÑŒ Ñ– ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ, Ñ‰Ð¾Ð± Ð½Ñ–Ñ‡Ð¾Ð³Ð¾ Ð½Ðµ Ð·Ñ–Ð¿ÑÑƒÐ²Ð°Ñ‚Ð¸",
        "Ð¡Ð¸Ð»ÑŒÐ½Ð¾ÑŽ Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑÑ‚ÑŽ Ð¼Ð¾Ð¶Ð½Ð° Ð½Ð°ÑˆÐºÐ¾Ð´Ð¸Ñ‚Ð¸",
        "ÐŸÑ€Ð°Ñ†ÑŽÑŽ Ñƒ Ð²ÑƒÐ·ÑŒÐºÐ¸Ñ… Ð¼Ñ–ÑÑ†ÑÑ…"
        ]
    },
    {
        "id": 5,
        "description": "ÐšÐ¨Ðœ Ð´Ð»Ñ Ñ€Ñ–Ð·Ð°Ð½Ð½Ñ, ÑˆÐ»Ñ–Ñ„ÑƒÐ²Ð°Ð½Ð½Ñ Ñ‚Ð° Ð·Ð°Ñ‡Ð¸ÑÑ‚ÐºÐ¸",
        "requirements": "Ð¼ÐµÑ€ÐµÐ¶ÐµÐ²Ð° Ð±Ð¾Ð»Ð³Ð°Ñ€ÐºÐ°, Ð²Ð¸ÑÐ¾ÐºÐ° Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑÑ‚ÑŒ Ñ– Ð·Ñ€ÑƒÑ‡Ð½Ñ–ÑÑ‚ÑŒ Ñƒ Ñ€Ð¾Ð±Ð¾Ñ‚Ñ–",
        "avatar": "6.png",
        "behavior": "Ð¿ÐµÑ€ÐµÐ²Ð°Ð¶Ð½Ð¾ ÑÐ¿Ð¾ÐºÑ–Ð¹Ð½Ð¸Ð¹, Ñ–Ð½Ð¾Ð´Ñ– ÑÑ…Ð¸Ð»ÑŒÐ½Ð¸Ð¹ Ð´Ð¾ ÐµÐºÑÐ¿ÐµÑ€Ð¸Ð¼ÐµÐ½Ñ‚Ñ–Ð²",
        "correct_models": ["GS-140SE", "GL-160SE", "GL-145S"],
        "wrong_models": ["GS-98", "GS-100S", "CG-12BC", "GL-125S", "DGA-201"],
        "hints": [
        "ÐœÐµÐ½Ñ– Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð¼ÐµÑ€ÐµÐ¶ÐµÐ²Ð° Ð±Ð¾Ð»Ð³Ð°Ñ€ÐºÐ° Ð´Ð»Ñ ÑˆÐ»Ñ–Ñ„ÑƒÐ²Ð°Ð½Ð½Ñ Ð¼ÐµÑ‚Ð°Ð»Ñƒ",
        "ÐŸÑ€Ð°Ñ†ÑŽÑŽ Ð· Ð¼ÐµÑ‚Ð°Ð»Ð¾Ð¼ Ñ‚Ð° ÑˆÐ»Ñ–Ñ„ÑƒÑŽ Ð²ÐµÐ»Ð¸ÐºÑ– Ð¿Ð¾Ð²ÐµÑ€Ñ…Ð½Ñ–",
        "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð° Ð²Ð¸ÑÐ¾ÐºÐ° Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑÑ‚ÑŒ, Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¸Ð²Ð½Ñ–ÑÑ‚ÑŒ Ñ– Ð½Ð°Ð´Ñ–Ð¹Ð½Ñ–ÑÑ‚ÑŒ",
        "Ð¢Ñ€ÐµÐ±Ð° Ð±Ð¾Ð»Ð³Ð°Ñ€ÐºÐ° Ð½Ð° 125 Ð¼Ð¼ Ð´Ñ–Ð°Ð¼ÐµÑ‚Ñ€ Ð´Ð¸ÑÐºÑƒ",
        "Ð¥Ð¾Ñ‡Ñƒ Ð½Ð°Ð´Ñ–Ð¹Ð½Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŽÐ²Ð°Ñ‚Ð¸ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚"
        ]
    },
    {
        "id": 6,
        "description": "Ð±Ð¾Ð»Ð³Ð°Ñ€ÐºÐ° Ð´Ð»Ñ Ñ€Ñ–Ð·ÐºÐ¸ Ð¼ÐµÑ‚Ð°Ð»Ñƒ Ñ‚Ð° Ð°Ñ€Ð¼Ð°Ñ‚ÑƒÑ€Ð¸",
        "requirements": "Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ° Ð¼ÐµÑ€ÐµÐ¶ÐµÐ²Ð° Ð±Ð¾Ð»Ð³Ð°Ñ€ÐºÐ°, Ð·Ñ€ÑƒÑ‡Ð½Ð° Ñ€ÑƒÐºÐ¾ÑÑ‚ÐºÐ°, Ñ€ÐµÐ³ÑƒÐ»ÑŽÐ²Ð°Ð½Ð½Ñ Ð¾Ð±ÐµÑ€Ñ‚Ñ–Ð²",
        "avatar": "id7.png",
        "behavior": "Ð°ÐºÑƒÑ€Ð°Ñ‚Ð½Ð¸Ð¹ Ñƒ Ñ€Ð¾Ð±Ð¾Ñ‚Ñ–, Ð°Ð»Ðµ Ñ–Ð½Ð¾Ð´Ñ– Ð¿Ð¾Ñ‚Ñ€ÐµÐ±ÑƒÑ” Ð²Ð¸ÑÐ¾ÐºÐ¾Ñ— Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ñ–",
        "correct_models": ["GS-98", "GS-100S"],
        "wrong_models": ["CG-12BC", "DGA-201", "GS-140SE", "GL-160SE", "GL-125S"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ Ð´Ð»Ñ Ñ‡Ð¸ÑÑ‚Ð¾Ð²Ð¾Ñ— Ð¾Ð±Ñ€Ð¾Ð±ÐºÐ¸ Ð¼ÐµÑ‚Ð°Ð»Ñƒ",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¾, Ñ‰Ð¾Ð± Ð±Ð¾Ð»Ð³Ð°Ñ€ÐºÐ° Ð±ÑƒÐ»Ð° ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð° Ñ‚Ð° Ð·Ñ€ÑƒÑ‡Ð½Ð°",
            "ÐŸÑ€Ð°Ñ†ÑŽÑŽ Ð· Ñ‚Ð¾Ð½ÐºÐ¸Ð¼ Ð¼ÐµÑ‚Ð°Ð»Ð¾Ð¼, Ñ‚Ð¾Ð¼Ñƒ Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑÑ‚ÑŒ Ð¼Ð¾Ð¶Ðµ Ð±ÑƒÑ‚Ð¸ Ð½ÐµÐ²ÐµÐ»Ð¸ÐºÐ¾ÑŽ",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ° Ñ€ÑƒÑ‡ÐºÐ°",
            "Ð”Ð¸ÑÐº 125 Ð¼Ð¼ â€“ Ñ–Ð´ÐµÐ°Ð»ÑŒÐ½Ð¸Ð¹ Ñ€Ð¾Ð·Ð¼Ñ–Ñ€ Ð´Ð»Ñ Ð¼Ð¾Ñ—Ñ… Ð·Ð°Ð´Ð°Ñ‡"
        ]
    },
    {
        "id": 7,
        "description": "Ð±Ð¾Ð»Ð³Ð°Ñ€ÐºÐ° Ð· Ñ€ÐµÐ³ÑƒÐ»ÑÑ‚Ð¾Ñ€Ð¾Ð¼ Ð´Ð»Ñ Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ð½Ð¸Ñ… Ñ€Ð¾Ð±Ñ–Ñ‚",
        "requirements": "Ð½Ð°Ð´Ñ–Ð¹Ð½Ð°, Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ð°, Ð· Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼ÐºÐ¾ÑŽ Ð¾Ð±ÐµÑ€Ñ‚Ñ–Ð²",
        "avatar": "id10.png",
        "behavior": "Ñ–Ð½Ñ‚ÐµÐ½ÑÐ¸Ð²Ð½Ðµ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ, Ð°Ð»Ðµ Ð· Ð´Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½ÑÐ¼ Ñ‚ÐµÑ…Ð½Ñ–ÐºÐ¸ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸",
        "correct_models": ["GS-140SE"],
        "wrong_models": ["GS-98", "GS-100S", "CG-12BC", "GL-125S", "DGA-201", "GL-160SE"],
        "hints": [
            "Ð§Ð°ÑÑ‚Ð¾ Ñ€Ñ–Ð¶Ñƒ Ð°Ñ€Ð¼Ð°Ñ‚ÑƒÑ€Ñƒ, Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° ÑÑ‚Ñ–Ð¹ÐºÑ–ÑÑ‚ÑŒ Ð´Ð¾ Ð½Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½ÑŒ",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð¼ÐµÑ€ÐµÐ¶ÐµÐ²Ð° Ð· Ð²ÐµÐ»Ð¸ÐºÐ¾ÑŽ Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑÑ‚ÑŽ",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¾, Ñ‰Ð¾Ð± Ð½Ðµ Ð¿ÐµÑ€ÐµÐ³Ñ€Ñ–Ð²Ð°Ð»Ð°ÑÑ Ð¿Ñ€Ð¸ Ñ‚Ñ€Ð¸Ð²Ð°Ð»Ñ–Ð¹ Ñ€Ð¾Ð±Ð¾Ñ‚Ñ–",
            "125 Ð¼Ð¼ Ð´Ñ–Ð°Ð¼ÐµÑ‚Ñ€ Ð´Ð¸ÑÐºÑƒ - Ð¼ÐµÐ½Ñ– Ð¿Ñ–Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ",
            "Ð Ð¾Ð·Ð³Ð»ÑÐ´Ð°ÑŽ Ð¼Ð¾Ð´ÐµÐ»Ñ– Ñ–Ð· ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾ÑŽ Ñ€ÑƒÑ‡ÐºÐ¾ÑŽ"
        ]
    },
    {
        "id": 8,
        "description": "Ð¿Ñ€Ð¾ÑÑ‚Ð° Ð±Ð¾Ð»Ð³Ð°Ñ€ÐºÐ° Ð´Ð¾Ð´Ð¾Ð¼Ñƒ",
        "requirements": "Ð·Ð´Ð°Ñ‚Ð½Ð° Ð²Ð¸ÐºÐ¾Ð½ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¾ÑÑ‚Ñ– Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ Ð±ÐµÐ· Ð¶Ð¾Ð´Ð½Ð¸Ñ… Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼",
        "avatar": "id1.png",
        "behavior": "Ð´Ñ–Ð´ÑƒÑÑŒ",
        "correct_models": ["GS-98", "GS-100S", "GL-125S"],
        "wrong_models": ["CG-12BC", "DGA-201", "GS-140SE", "GL-160SE"],
        "hints": [
            "Ð¨Ð»Ñ–Ñ„ÑƒÑŽ Ð·Ð²Ð°Ñ€Ð½Ñ– ÑˆÐ²Ð¸, Ñ€Ñ–Ð¶Ñƒ Ð°Ñ€Ð¼Ð°Ñ‚ÑƒÑ€Ñƒ Ð² Ð³Ð°Ñ€Ð°Ð¶Ñ–",
            "Ð¢Ñ€ÐµÐ±Ð° Ð½ÐµÐ´Ð¾Ñ€Ð¾Ð³Ð° Ð¼Ð¾Ð´ÐµÐ»ÑŒ",
            "ÐšÑ€Ð°Ñ‰Ðµ Ð· Ð´Ð¾Ð²Ð³Ð¾ÑŽ Ñ€ÑƒÑ‡ÐºÐ¾ÑŽ, Ð±Ð¾ Ñ€ÑƒÐºÐ¸ Ð²Ð¶Ðµ Ñ‚Ñ€Ð¾Ñ…Ð¸ Ð½Ðµ Ñ‚Ñ€Ð¸Ð¼Ð°ÑŽÑ‚ÑŒ",
            "125 Ð¼Ð¼ Ð´Ñ–Ð°Ð¼ÐµÑ‚Ñ€ Ð´Ð¸ÑÐºÑƒ Ñ–Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾ Ð¿Ñ–Ð´Ñ–Ð¹Ð´Ðµ"
        ]
    },
    {
        "id": 9,
        "description": "Ð°ÐºÑƒÐ¼ÑƒÐ»ÑÑ‚Ð¾Ñ€Ð½Ð° Ð±Ð¾Ð»Ð³Ð°Ñ€ÐºÐ° Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð¿Ñ–Ð´ Ð¼Ð°ÑˆÐ¸Ð½Ð¾ÑŽ",
        "requirements": "Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ° Ð°ÐºÑƒÐ¼ÑƒÐ»ÑÑ‚Ð¾Ñ€Ð½Ð° Ð±Ð¾Ð»Ð³Ð°Ñ€ÐºÐ° Ð´Ð»Ñ Ð²ÑƒÐ·ÑŒÐºÐ¾ÑÐ¿ÐµÑ†Ñ–Ð°Ð»Ñ–Ð·Ð¾Ð²Ð°Ð½Ð¸Ñ… Ð·Ð°Ð²Ð´Ð°Ð½ÑŒ",
        "avatar": "id2.png",
        "behavior": "ÐµÐºÑÐ¿ÐµÑ€Ñ‚ Ð· Ð°Ð²Ñ‚Ð¾Ð¼Ð¾Ð±Ñ–Ð»Ñ–Ð²",
        "correct_models": ["DGA-201", "CG-12BC"],
        "wrong_models": ["GS-98", "GS-100S", "GL-125S", "GS-140SE", "GL-160SE"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾ Ð·Ñ€ÑƒÑ‡Ð½Ð¸Ð¹ Ñ‚Ð° ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð¸Ð¹",
            "Ð¿Ñ€Ð°Ñ†ÑŽÑŽ Ð¿Ñ–Ð´ Ð¼Ð°ÑˆÐ¸Ð½Ð¾ÑŽ, Ð²Ð°Ð¶Ð»Ð¸Ð²Ð° Ð¼Ð¾Ð±Ñ–Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ",
            "Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ Ñ–Ð· ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾ÑŽ Ñ€ÑƒÑ‡ÐºÐ¾ÑŽ",
            "Ð¿Ñ€Ð°Ñ†ÑŽÑŽ Ð»Ð¸ÑˆÐµ Ð· Ð¼ÐµÑ‚Ð°Ð»Ð¾Ð¼ Ñ‚Ð¾Ð²Ñ‰Ð¸Ð½Ð°Ð¼Ð¸ Ð´Ð¾ 4 Ð¼Ð¼"
        ]
    },
    {
        "id": 10,
        "description": "Ð»ÐµÐ³ÐºÐ¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð´Ð¾Ð¼Ð°ÑˆÐ½ÑŒÐ¾Ð³Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ",
        "requirements": "ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð¸Ð¹ Ñ‚Ð° Ð½ÐµÐ´Ð¾Ñ€Ð¾Ð³Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð¿Ð¾ Ð´Ð¾Ð¼Ñƒ",
        "avatar": "id5.png",
        "behavior": "ÐºÑ€Ð°ÑÐ¸Ð²Ð¸Ð¹ ÐºÐ»Ñ–Ñ”Ð½Ñ‚",
        "correct_models": ["DHR-200", "DHR-202BC"],
        "wrong_models": ["BH-30", "BH-20", "RH-16"],
        "hints": [
            "Ð¨ÑƒÐºÐ°ÑŽ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð½ÐµÑ‡Ð°ÑÑ‚Ð¾Ð³Ð¾ Ð´Ð¾Ð¼Ð°ÑˆÐ½ÑŒÐ¾Ð³Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ñ–Ð½Ð¾Ð´Ñ– Ð¿Ñ€Ð¾ÑÐ²ÐµÑ€Ð»Ð¸Ñ‚Ð¸ Ð¾Ñ‚Ð²Ñ–Ñ€ Ñƒ ÑÑ‚Ñ–Ð½Ñ–",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¾, Ñ‰Ð¾Ð± Ð±ÑƒÐ² Ð»ÐµÐ³ÐºÐ¸Ð¹ Ñ– Ð½Ðµ Ð·Ð°Ð¹Ð¼Ð°Ð² Ð±Ð°Ð³Ð°Ñ‚Ð¾ Ð¼Ñ–ÑÑ†Ñ",
            "ÐÐµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ð¸Ð¹ Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ð¸Ð¹ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚",
            "Ð‘ÑŽÐ´Ð¶ÐµÑ‚ Ð´Ð¾ 3000 Ð³Ñ€Ð½"
        ]
    },
    {
        "id": 11,
        "description": "Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð´Ñ€Ñ–Ð±Ð½Ð¾Ð³Ð¾ Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ñƒ",
        "requirements": "Ð°ÐºÑƒÐ¼ÑƒÐ»ÑÑ‚Ð¾Ñ€Ð½Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð· Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð¼ ÑƒÐ´Ð°Ñ€Ñƒ",
        "avatar": "id4.png",
        "behavior": "Ð·Ð°Ð»ÑÐºÐ°Ð½Ð¸Ð¹ ÐºÐ»Ñ–Ñ”Ð½Ñ‚",
        "correct_models": ["DHR-201BC"],
        "wrong_models": ["RH-100", "BH-14S", "BH-30", "RH-12Q", "RH-16"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð´Ñ€Ñ–Ð±Ð½Ð¸Ñ… Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ð½Ð¸Ñ… Ñ€Ð¾Ð±Ñ–Ñ‚",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¾ Ð¼Ð°Ñ‚Ð¸ Ñ€ÐµÐ¶Ð¸Ð¼ Ñ€ÑƒÐ¹Ð½ÑƒÐ²Ð°Ð½Ð½Ñ Ð´Ð»Ñ Ð´ÐµÐ¼Ð¾Ð½Ñ‚Ð°Ð¶Ð½Ð¸Ñ… Ñ€Ð¾Ð±Ñ–Ñ‚",
            "Ð¨ÑƒÐºÐ°ÑŽ Ð±ÐµÐ·Ñ‰Ñ–Ñ‚ÐºÐ¾Ð²Ð¸Ð¹ Ð´Ð²Ð¸Ð³ÑƒÐ½ Ð´Ð»Ñ Ð´Ð¾Ð²Ð³Ð¾Ð²Ñ–Ñ‡Ð½Ð¾ÑÑ‚Ñ–",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð±Ð°Ð»Ð°Ð½ÑÐ¾Ð²Ð°Ð½Ð° Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑÑ‚ÑŒ",
            "Ð‘ÑŽÐ´Ð¶ÐµÑ‚ Ð´Ð¾ 4000 Ð³Ñ€Ð½"
        ]
    },
    {
        "id": 12,
        "description": "Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾Ð³Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ",
        "requirements": "Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ð¸Ð¹ Ñ‚Ð° Ð·Ñ€ÑƒÑ‡Ð½Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ‡Ð°ÑÑ‚Ð¾Ð³Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ",
        "avatar": "id12.png",
        "behavior": "ÐºÐ»Ñ–Ñ”Ð½Ñ‚-Ð·Ð°Ð´Ñ€Ð¾Ñ‚",
        "correct_models": ["DHR-202BC", "DHR-201BC"],
        "wrong_models": ["DHR-200", "RH-100", "BH-30", "RH-12Q", "RH-16"],
        "hints": [
            "Ð¨ÑƒÐºÐ°ÑŽ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¸Ñ… Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ð½Ð¸Ñ… Ñ€Ð¾Ð±Ñ–Ñ‚",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð° Ð°Ð½Ñ‚Ð¸Ð²Ñ–Ð±Ñ€Ð°Ñ†Ñ–Ð¹Ð½Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð´Ð»Ñ ÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚Ð½Ð¾Ñ— Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð±Ñ–Ð»ÑŒÑˆÐ° ÑƒÐ´Ð°Ñ€Ð½Ð° ÑÐ¸Ð»Ð° Ð½Ñ–Ð¶ Ñƒ Ð±Ð°Ð·Ð¾Ð²Ð¸Ñ… Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹",
            "Ð‘Ð¾Ñ‡ÐºÐ¾Ð²Ð° ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–Ñ Ð´Ð»Ñ ÐºÑ€Ð°Ñ‰Ð¾Ð³Ð¾ Ð±Ð°Ð»Ð°Ð½ÑÑƒ",
            "Ð“Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚Ð¸ Ð·Ð° ÑÐºÑ–ÑÑ‚ÑŒ"
        ]
    },
    {
        "id": 13,
        "description": "Ð±ÑŽÐ´Ð¶ÐµÑ‚Ð½Ð¸Ð¹ Ð¿Ñ€ÑÐ¼Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€",
        "requirements": "Ð½ÐµÐ´Ð¾Ñ€Ð¾Ð³Ð¸Ð¹ Ñ‚Ð° Ð½Ð°Ð´Ñ–Ð¹Ð½Ð¸Ð¹ Ð¿Ñ€ÑÐ¼Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€",
        "avatar": "id13.png",
        "behavior": "ÑÐ¼Ñ–ÑˆÐ½Ð¸Ð¹ ÐºÐ»Ñ–Ñ”Ð½Ñ‚",
        "correct_models": ["RH-100", "RH-12Q"],
        "wrong_models": ["DHR-202BC", "BH-20", "BH-30", "DHR-200", "BH-14S"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ð¹ Ñ– Ð½Ð°Ð´Ñ–Ð¹Ð½Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¾ Ð¼Ð°Ñ‚Ð¸ Ñ…Ð¾Ñ€Ð¾ÑˆÑƒ ÑƒÐ´Ð°Ñ€Ð½Ñƒ ÑÐ¸Ð»Ñƒ Ð·Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñƒ Ñ†Ñ–Ð½Ñƒ",
            "ÐšÐµÐ¹Ñ Ñƒ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚Ñ– - Ð²ÐµÐ»Ð¸ÐºÐ¸Ð¹ Ð¿Ð»ÑŽÑ",
            "ÐÐµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ—",
            "Ð‘ÑŽÐ´Ð¶ÐµÑ‚ Ð´Ð¾ 4500 Ð³Ñ€Ð½"
        ]
    },
    {
        "id": 14,
        "description": "ÑƒÐ½Ñ–Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ð¸Ð¹ Ð¿Ñ€ÑÐ¼Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€",
        "requirements": "Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð· Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð¸Ð¼Ð¸ Ð¼Ð¾Ð¶Ð»Ð¸Ð²Ð¾ÑÑ‚ÑÐ¼Ð¸ Ð´Ð»Ñ Ñ€Ñ–Ð·Ð½Ð¸Ñ… Ð·Ð°Ð´Ð°Ñ‡",
        "avatar": "id14.png",
        "behavior": "ÐºÐ»Ñ–Ñ”Ð½Ñ‚-ÑÐ»ÑŽÑÐ°Ñ€",
        "correct_models": ["RH-12Q"],
        "wrong_models": ["RH-100", "DHR-200", "BH-14S", "BH-30", "RH-16"],
        "hints": [
            "Ð¨ÑƒÐºÐ°ÑŽ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€, ÑÐºÐ¸Ð¹ Ð¼Ð¾Ð¶Ðµ Ñ– ÑÐ²ÐµÑ€Ð»Ð¸Ñ‚Ð¸, Ñ– Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ ÑÐº Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€",
            "Ð”Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð¸Ð¹ Ð¿Ð°Ñ‚Ñ€Ð¾Ð½ Ð´Ð»Ñ ÑÐ²ÐµÑ€Ð´ÐµÐ» - Ð²Ð°Ð¶Ð»Ð¸Ð²Ð° Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð³Ð°Ñ€Ð½Ð° ÑƒÐ´Ð°Ñ€Ð½Ð° ÑÐ¸Ð»Ð°",
            "Ð¥Ð¾Ñ‡Ñƒ Ñ‰Ð¾Ð± Ð¹ÑˆÐ¾Ð² Ñƒ ÐºÐµÐ¹ÑÑ–",
            "Ð“Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚Ð¸ Ð·Ð° Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ð¼Ð¾Ð¶Ð»Ð¸Ð²Ð¾ÑÑ‚Ñ–"
        ]
    },
    {
        "id": 15,
        "description": "Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ð¸Ð¹ Ð¿Ñ€ÑÐ¼Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€",
        "requirements": "Ð½Ð°Ð¹Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑˆÐ¸Ð¹ Ð¿Ñ€ÑÐ¼Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ ÑÐºÐ»Ð°Ð´Ð½Ð¸Ñ… Ð·Ð°Ð´Ð°Ñ‡",
        "avatar": "id15.png",
        "behavior": "Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ñ–ÑÑ‚",
        "correct_models": ["RH-16"],
        "wrong_models": ["DHR-200", "RH-100", "DHR-201BC", "BH-14S", "RH-12Q"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð½Ð°Ð¹Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑˆÐ¸Ð¹ Ð¿Ñ€ÑÐ¼Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€",
            "Ð’Ð¸ÐºÐ¾Ð½ÑƒÑŽ Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ñ– Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ð½Ñ– Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð° Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð° ÑƒÐ´Ð°Ñ€Ð½Ð° ÑÐ¸Ð»Ð°",
            "ÐšÐµÐ¹Ñ Ñƒ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚Ñ– - Ð¾Ð±Ð¾Ð²'ÑÐ·ÐºÐ¾Ð²Ð¾",
            "Ð¦Ñ–Ð½Ð° Ð½Ðµ Ð³Ð¾Ð»Ð¾Ð²Ð½Ð¸Ð¹ ÐºÑ€Ð¸Ñ‚ÐµÑ€Ñ–Ð¹"
        ]
    },
    {
        "id": 16,
        "description": "ÑƒÐ½Ñ–Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ð¸Ð¹ Ð±Ð¾Ñ‡ÐºÐ¾Ð²Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€",
        "requirements": "Ð±Ð°Ð»Ð°Ð½ÑÐ¾Ð²Ð°Ð½Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ€Ñ–Ð·Ð½Ð¸Ñ… Ð²Ð¸Ð´Ñ–Ð² Ñ€Ð¾Ð±Ñ–Ñ‚",
        "avatar": "id10.png",
        "behavior": "Ð»ÑŽÐ´Ð¸Ð½Ð°-Ð½Ð°ÑÑ‚Ñ€Ñ–Ð¹",
        "correct_models": ["BH-14S", "BH-20"],
        "wrong_models": ["DHR-200", "RH-100", "BH-30", "RH-100"],
        "hints": [
            "Ð¨ÑƒÐºÐ°ÑŽ ÑƒÐ½Ñ–Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ€Ñ–Ð·Ð½Ð¸Ñ… Ð·Ð°Ð´Ð°Ñ‡",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð° Ð°Ð½Ñ‚Ð¸Ð²Ñ–Ð±Ñ€Ð°Ñ†Ñ–Ð¹Ð½Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ð°",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð¾ÐºÑ€ÐµÐ¼Ð¸Ð¹ Ñ€ÐµÐ³ÑƒÐ»ÑÑ‚Ð¾Ñ€ Ð¾Ð±ÐµÑ€Ñ‚Ñ–Ð²",
            "Ð‘Ð¾Ñ‡ÐºÐ¾Ð²Ð° ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–Ñ Ð´Ð»Ñ Ð·Ñ€ÑƒÑ‡Ð½Ð¾ÑÑ‚Ñ–",
            "Ð“Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹ Ð·Ð°Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚Ð¸ Ð·Ð° ÑÐºÑ–ÑÑ‚ÑŒ"
        ]
    },
    {
        "id": 17,
        "description": "Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ð¸Ð¹ Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ð¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€",
        "requirements": "Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ–Ð½Ñ‚ÐµÐ½ÑÐ¸Ð²Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ð¾Ð³Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ",
        "avatar": "id1.png",
        "behavior": "ÐºÐ»Ñ–Ñ”Ð½Ñ‚-Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¾Ð½Ð°Ð»",
        "correct_models": ["BH-20", "BH-30"],
        "wrong_models": ["DHR-200", "RH-100", "DHR-201BC", "RH-16"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ð¸Ð¹ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ Ð´Ð»Ñ Ð²Ð°Ð¶ÐºÐ¸Ñ… Ñ€Ð¾Ð±Ñ–Ñ‚",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ñ– Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— ÑÐº Ñ–Ð½Ð´Ð¸ÐºÐ°Ñ†Ñ–Ñ Ð·Ð½Ð¾ÑÑƒ",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð²Ð¸ÑÐ¾ÐºÐ° ÑƒÐ´Ð°Ñ€Ð½Ð° ÑÐ¸Ð»Ð°",
            "Ð’Ð¸ÐºÐ¾Ð½ÑƒÑŽ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ñ‰Ð¾Ð´Ð½Ñ",
            "Ð¦Ñ–Ð½Ð° Ð²Ð¸Ð¿Ñ€Ð°Ð²Ð´Ð°Ð½Ð° ÑÐºÑ–ÑÑ‚ÑŽ"
        ]
    },
    {
        "id": 18,
        "description": "Ð½Ð°Ð¹Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑˆÐ¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ ÑÐ¿ÐµÑ†Ð·Ð°Ð²Ð´Ð°Ð½ÑŒ",
        "requirements": "Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð½Ð°Ð¹ÑÐºÐ»Ð°Ð´Ð½Ñ–ÑˆÐ¸Ñ… Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ð¸Ñ… Ð·Ð°Ð´Ð°Ñ‡",
        "avatar": "id2.png",
        "behavior": "ÐºÐ»Ñ–Ñ”Ð½Ñ‚-ÐºÐ¾Ð¼ÑƒÐ½Ð°Ð»ÑŒÐ½Ð¸Ðº",
        "correct_models": ["BH-30"],
        "wrong_models": ["DHR-200", "RH-100", "DHR-201BC"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð½Ð°Ð¹Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑˆÐ¸Ð¹ Ð¿ÐµÑ€Ñ„Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€ Ð½Ð° Ñ€Ð¸Ð½ÐºÑƒ",
            "Ð’Ð¸ÐºÐ¾Ð½ÑƒÑŽ ÑÐ¿ÐµÑ†Ñ–Ð°Ð»ÑŒÐ½Ñ– Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ñ– Ð·Ð°Ð²Ð´Ð°Ð½Ð½Ñ",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¸Ð¹ Ð¿Ð°Ñ‚Ñ€Ð¾Ð½ SDSMAX Ð´Ð»Ñ Ð²Ð°Ð¶ÐºÐ¸Ñ… Ð½Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½ÑŒ",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð° ÑƒÐ´Ð°Ñ€Ð½Ð° ÑÐ¸Ð»Ð°",
            "Ð¦Ñ–Ð½Ð° Ð½Ðµ Ð³Ð¾Ð»Ð¾Ð²Ð½Ðµ - Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¸Ð²Ð½Ñ–ÑÑ‚ÑŒ"
        ]
    },
    {
        "id": 19,
        "description": "Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ð¸Ð¹ Ñ–Ð½Ð²ÐµÑ€Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð² Ñ‚Ñ–ÑÐ½Ð¸Ñ… ÑƒÐ¼Ð¾Ð²Ð°Ñ…",
        "requirements": "Ð¼Ð°Ð»Ð¸Ð¹ Ñ‚Ð° Ð»ÐµÐ³ÐºÐ¸Ð¹ Ð·Ð²Ð°Ñ€ÑŽÐ²Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð°Ð¿Ð°Ñ€Ð°Ñ‚ Ð´Ð»Ñ Ð¿ÐµÑ€Ñ–Ð¾Ð´Ð¸Ñ‡Ð½Ð¾Ð³Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ",
        "avatar": "id11.png",
        "behavior": "ÐºÐ»Ñ–Ñ”Ð½Ñ‚-Ñ€ÐµÐ¼Ð¾Ð½Ñ‚Ð½Ð¸Ðº",
        "correct_models": ["SAB-14DMINI"],
        "wrong_models": ["SAB-15DX", "M-16PW", "SAB-17DX", "M-20D"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð½Ð°Ð¹Ð¼ÐµÐ½ÑˆÐ¸Ð¹ Ñ–Ð½Ð²ÐµÑ€Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð² Ð¾Ð±Ð¼ÐµÐ¶ÐµÐ½Ð¸Ñ… Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ñ€Ð°Ñ…",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¾, Ñ‰Ð¾Ð± Ð±ÑƒÐ»Ð° Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ HOT START Ð´Ð»Ñ Ð»ÐµÐ³ÐºÐ¾Ð³Ð¾ Ð¿Ñ–Ð´Ð¿Ð°Ð»Ñƒ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð´Ð°",
            "ÐŸÑ€Ð°Ñ†ÑŽÑŽ Ð· ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð´Ð°Ð¼Ð¸ Ð´Ð¾ 4 Ð¼Ð¼",
            "ÐÐµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ—, Ð³Ð¾Ð»Ð¾Ð²Ð½Ðµ â€” ÐºÐ¾Ð¼Ð¿Ð°ÐºÑ‚Ð½Ñ–ÑÑ‚ÑŒ",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð½ÐµÐ´Ð¾Ñ€Ð¾Ð³Ð¸Ð¹ Ð²Ð°Ñ€Ñ–Ð°Ð½Ñ‚ Ð´Ð»Ñ Ð½ÐµÑ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾Ð³Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ"
        ]
    },
    {
        "id": 20,
        "description": "Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ ÑƒÐ½Ñ–Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ð¸Ð¹ Ñ–Ð½Ð²ÐµÑ€Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ€Ñ–Ð·Ð½Ð¸Ñ… Ð²Ð¸Ð´Ñ–Ð² Ð·Ð²Ð°Ñ€ÑŽÐ²Ð°Ð½Ð½Ñ",
        "requirements": "Ð°Ð¿Ð°Ñ€Ð°Ñ‚ Ð· TIG-LIFT Ñ‚Ð° Ð·Ñ€ÑƒÑ‡Ð½Ð¸Ð¼ Ñ„ÑƒÐ½ÐºÑ†Ñ–Ð¾Ð½Ð°Ð»Ð¾Ð¼",
        "avatar": "id16.png",
        "behavior": "ÐºÐ»Ñ–Ñ”Ð½Ñ‚-Ð¼Ð°Ð¹ÑÑ‚ÐµÑ€ Ð½Ð° Ð²Ð¸Ñ€Ð¾Ð±Ð½Ð¸Ñ†Ñ‚Ð²Ñ–",
        "correct_models": ["SAB-15DX", "SAB-17DX"],
        "wrong_models": ["SAB-14DMINI", "M-18D", "M-20D", "M-16PW"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ñ–Ð½Ð²ÐµÑ€Ñ‚Ð¾Ñ€ Ñ–Ð· Ñ€ÐµÐ¶Ð¸Ð¼Ð¾Ð¼ TIG-LIFT Ð´Ð»Ñ Ð°Ñ€Ð³Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ð·Ð²Ð°Ñ€ÑŽÐ²Ð°Ð½Ð½Ñ",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ñ– Ð²ÑÑ– Ð±Ð°Ð·Ð¾Ð²Ñ– Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— Ð´Ð»Ñ ÐºÐ¾Ð¼Ñ„Ð¾Ñ€Ñ‚Ð½Ð¾Ñ— Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸",
            "ÐŸÑ€Ð°Ñ†ÑŽÑŽ Ð· Ñ€Ñ–Ð·Ð½Ð¸Ð¼Ð¸ Ñ‚Ð¸Ð¿Ð°Ð¼Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ñ–Ð²",
            "ÐÐµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð° Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑÑ‚ÑŒ, Ð³Ð¾Ð»Ð¾Ð²Ð½Ðµ â€” ÑƒÐ½Ñ–Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ",
            "Ð’ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚Ñ– Ð¿Ð¾Ð²Ð¸Ð½Ð½Ñ– Ð±ÑƒÑ‚Ð¸ ÐºÐ°Ð±ÐµÐ»Ñ–"
        ]
    },
    {
        "id": 21,
        "description": "Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð½Ð°Ð´Ñ–Ð¹Ð½Ð¸Ð¹ Ñ–Ð½Ð²ÐµÑ€Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð¿Ñ€Ð¸ Ð½Ð¸Ð·ÑŒÐºÑ–Ð¹ Ð½Ð°Ð¿Ñ€ÑƒÐ·Ñ–",
        "requirements": "Ð°Ð¿Ð°Ñ€Ð°Ñ‚, ÑÐºÐ¸Ð¹ Ð¿Ñ€Ð°Ñ†ÑŽÑ” Ð²Ñ–Ð´ 140 Ð’ Ñ– Ð¼Ð°Ñ” Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¹ Ð·Ð°Ñ…Ð¸ÑÑ‚",
        "avatar": "id17.png",
        "behavior": "ÐºÐ»Ñ–Ñ”Ð½Ñ‚-ÐµÐ»ÐµÐºÑ‚Ñ€Ð¸Ðº Ñƒ ÑÑ–Ð»ÑŒÑÑŒÐºÑ–Ð¹ Ð¼Ñ–ÑÑ†ÐµÐ²Ð¾ÑÑ‚Ñ–",
        "correct_models": ["M-16PW"],
        "wrong_models": ["SAB-14DMINI", "SAB-17DX", "M-18D", "M-20D"],
        "hints": [
            "Ð§Ð°ÑÑ‚Ð¾ Ð¿Ñ€Ð°Ñ†ÑŽÑŽ Ñ‚Ð°Ð¼, Ð´Ðµ Ð½ÐµÑÑ‚Ð°Ð±Ñ–Ð»ÑŒÐ½Ð° Ð½Ð°Ð¿Ñ€ÑƒÐ³Ð° (Ð½Ð¸Ð·ÑŒÐºÐ° Ð°Ð±Ð¾ ÐºÐ¾Ð»Ð¸Ð²Ð°Ñ”Ñ‚ÑŒÑÑ)",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ ÑÑÐºÑ€Ð°Ð²Ð¸Ð¹ Ð´Ð¸ÑÐ¿Ð»ÐµÐ¹ Ð´Ð»Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð½Ð° ÑÐ¾Ð½Ñ†Ñ–",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð° Ð·Ð°Ñ…Ð¸Ñ‰ÐµÐ½Ñ–ÑÑ‚ÑŒ Ð²Ñ–Ð´ Ð¿ÐµÑ€ÐµÐ³Ñ€Ñ–Ð²Ñƒ Ñ‚Ð° Ð¿ÐµÑ€ÐµÐ²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½ÑŒ",
            "ÐŸÑ€Ð°Ñ†ÑŽÑŽ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð´Ð°Ð¼Ð¸ Ð´Ð¾ 4 Ð¼Ð¼",
            "ÐÐµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– ÑÐºÐ»Ð°Ð´Ð½Ñ– Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ—, Ð³Ð¾Ð»Ð¾Ð²Ð½Ðµ â€” ÑÑ‚Ð°Ð±Ñ–Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ"
        ]
    },
    {
        "id": 22,
        "description": "Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ð¸Ð¹ Ñ–Ð½Ð²ÐµÑ€Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð²Ð°Ð¶ÐºÐ¸Ñ… Ð·Ð°Ð²Ð´Ð°Ð½ÑŒ",
        "requirements": "Ð°Ð¿Ð°Ñ€Ð°Ñ‚ Ð´Ð»Ñ Ñ‚Ñ€Ð¸Ð²Ð°Ð»Ð¾Ñ— Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ Ð· Ñ‚Ð¾Ð²ÑÑ‚Ð¸Ð¼Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð°Ð¼Ð¸",
        "avatar": "id18.png",
        "behavior": "ÐºÐ»Ñ–Ñ”Ð½Ñ‚-Ð·Ð²Ð°Ñ€Ð½Ð¸Ðº Ð½Ð° Ð±ÑƒÐ´Ñ–Ð²Ð½Ð¸Ñ†Ñ‚Ð²Ñ–",
        "correct_models": ["SAB-17DX", "M-18D", "M-20D"],
        "wrong_models": ["SAB-14DMINI", "M-16PW", "SAB-15DX"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð²Ð°Ñ€Ð¸Ñ‚Ð¸ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð´Ð°Ð¼Ð¸ Ð´Ð¾ 5 Ð¼Ð¼",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¸Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ TIG-LIFT Ð´Ð»Ñ ÑÐºÑ–ÑÐ½Ð¾Ð³Ð¾ Ð°Ñ€Ð³Ð¾Ð½Ð½Ð¾Ð³Ð¾ Ð·Ð²Ð°Ñ€ÑŽÐ²Ð°Ð½Ð½Ñ",
            "ÐŸÑ€Ð°Ñ†ÑŽÑŽ Ð· Ñ‚Ð¾Ð²ÑÑ‚Ð¸Ð¼Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð°Ð¼Ð¸ (5+ Ð¼Ð¼)",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð½Ð°Ð´Ñ–Ð¹Ð½Ñ–ÑÑ‚ÑŒ Ð¿Ñ€Ð¸ Ñ‚Ñ€Ð¸Ð²Ð°Ð»Ð¾Ð¼Ñƒ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ–",
            "Ð“Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹ Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚Ð¸ Ð·Ð° Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ð¸Ð¹ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚"
        ]
    },
    {
        "id": 23,
        "description": "Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð´Ð¾Ð²Ð³Ð¾Ð²Ñ–Ñ‡Ð½Ð¸Ð¹ Ñ–Ð½Ð²ÐµÑ€Ñ‚Ð¾Ñ€ Ð· Ð³Ð°Ñ€Ð°Ð½Ñ‚Ñ–Ñ”ÑŽ",
        "requirements": "Ð½Ð°Ð´Ñ–Ð¹Ð½Ð¸Ð¹ Ð°Ð¿Ð°Ñ€Ð°Ñ‚ Ð±ÐµÐ· Ð·Ð°Ð¹Ð²Ð¸Ñ… Ñ„ÑƒÐ½ÐºÑ†Ñ–Ð¹",
        "avatar": "id19.png",
        "behavior": "ÐºÐ»Ñ–Ñ”Ð½Ñ‚-Ð±Ñ€Ð¸Ð³Ð°Ð´Ð¸Ñ€ Ð±ÑƒÐ´Ñ–Ð²ÐµÐ»ÑŒÐ½Ð¾Ñ— ÐºÐ¾Ð¼Ð¿Ð°Ð½Ñ–Ñ—",
        "correct_models": ["M-18D"],
        "wrong_models": ["SAB-15DX", "M-20D", "SAB-17DX", "M-16PW"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð³Ð°Ñ€Ð°Ð½Ñ‚Ñ–Ñ 5+ Ñ€Ð¾ÐºÑ–Ð²",
            "ÐŸÑ€Ð°Ñ†ÑŽÑŽ Ð¿ÐµÑ€ÐµÐ²Ð°Ð¶Ð½Ð¾ ÐµÐ»ÐµÐºÑ‚Ñ€Ð¾Ð´Ð°Ð¼Ð¸ Ð´Ð¾ 5 Ð¼Ð¼",
            "ÐÐµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ñ– TIG-LIFT Ñ‚Ð° VRD",
            "Ð¨ÑƒÐºÐ°ÑŽ Ð±Ð°Ð»Ð°Ð½Ñ Ð¼Ñ–Ð¶ Ñ†Ñ–Ð½Ð¾ÑŽ Ñ‚Ð° Ð½Ð°Ð´Ñ–Ð¹Ð½Ñ–ÑÑ‚ÑŽ",
            "Ð†Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ Ð¿Ð¾Ð²Ð¸Ð½ÐµÐ½ Ð²Ð¸Ñ‚Ñ€Ð¸Ð¼ÑƒÐ²Ð°Ñ‚Ð¸ Ñ‰Ð¾Ð´ÐµÐ½Ð½Ðµ Ð½Ð°Ð²Ð°Ð½Ñ‚Ð°Ð¶ÐµÐ½Ð½Ñ"
        ]
    },
    {
        "id": 24,
        "description": "Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ð½Ð°Ð¹Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑˆÐ¸Ð¹ Ñ–Ð½Ð²ÐµÑ€Ñ‚Ð¾Ñ€ Ð´Ð»Ñ Ð²Ð°Ð¶ÐºÐ¸Ñ… Ð¼ÐµÑ‚Ð°Ð»Ñ–Ð²",
        "requirements": "Ð°Ð¿Ð°Ñ€Ð°Ñ‚ Ð´Ð»Ñ Ð·Ð²Ð°Ñ€ÑŽÐ²Ð°Ð½Ð½Ñ Ñ‚Ð¾Ð²ÑÑ‚Ð¸Ñ… ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ñ–Ð¹ (10+ Ð¼Ð¼)",
        "avatar": "id20.png",
        "behavior": "ÐºÐ»Ñ–Ñ”Ð½Ñ‚-Ñ–Ð½Ð¶ÐµÐ½ÐµÑ€ Ð½Ð° Ð¼ÐµÑ‚Ð°Ð»ÑƒÑ€Ð³Ñ–Ð¹Ð½Ð¾Ð¼Ñƒ Ð¿Ñ–Ð´Ð¿Ñ€Ð¸Ñ”Ð¼ÑÑ‚Ð²Ñ–",
        "correct_models": ["M-20D", "M-18D"],
        "wrong_models": ["SAB-14DMINI", "M-16PW", "M-18D"],
        "hints": [
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð²Ð°Ñ€Ð¸Ñ‚Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð¸ Ñ‚Ð¾Ð²Ñ‰Ð¸Ð½Ð¾ÑŽ Ð¿Ð¾Ð½Ð°Ð´ 10 Ð¼Ð¼",
            "Ð’Ð°Ð¶Ð»Ð¸Ð²Ð¸Ð¹ ÑˆÐ¸Ñ€Ð¾ÐºÐ¸Ð¹ Ð´Ð¸ÑÐ¿Ð»ÐµÐ¹ Ð´Ð»Ñ Ñ‚Ð¾Ñ‡Ð½Ð¸Ñ… Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½ÑŒ",
            "ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð° Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½Ñ–ÑÑ‚ÑŒ",
            "Ð“Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹ Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚Ð¸ Ð·Ð° Ð¿Ñ€Ð¾Ñ„ÐµÑÑ–Ð¹Ð½Ðµ Ð¾Ð±Ð»Ð°Ð´Ð½Ð°Ð½Ð½Ñ",
            "Ð’ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚Ñ– Ð¿Ð¾Ð²Ð¸Ð½Ð½Ñ– Ð±ÑƒÑ‚Ð¸ ÐºÐ°Ð±ÐµÐ»Ñ–"
        ]
    }
]

TOOL_MODELS = [
    "CD-12QX",
    "CD-200BCULTRA",
    "CD-201HBC",
    "CD-218Q",
    "CD-200BCCOMPACT",
    "CD-12CX",
    "CD-12BC",
    "GS-140SE",
    "GL-160SE",
    "GS-98",
    "GS-100S",
    "GL-145S",
    "GS-120S",
    "GL-240",
    "CG-12BC",
    "GL-125S",
    "DGA-201",
    "DHR-200",
    "DHR-201BC",
    "DHR-202BC",
    "RH-100",
    "RH-12Q",
    "RH-16",
    "BH-14S",
    "BH-20",
    "BH-30",
    "SAB-14DMINI",
    "SAB-15DX",
    "M-16PW",
    "SAB-17DX",
    "M-18D",
    "M-20D"
]

UNACCEPTABLE_BEHAVIOR_PROMPT = """
Ð¯ÐºÑ‰Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð¿Ð¸ÑˆÐµ Ð¼Ð°Ñ‚ÑŽÐºÐ¸ Ñ‚Ð° ÑÐ»Ð¾Ð²Ð°, ÑÐºÑ– Ñ” Ð½ÐµÐ´Ð¾Ð¿ÑƒÑÑ‚Ð¸Ð¼Ð¸ Ð¿Ñ€Ð¸ ÑÐ¿Ñ–Ð»ÐºÑƒÐ²Ð°Ð½Ð½Ñ– Ð· ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°Ð¼Ð¸, 
Ñ‚Ð¸ Ð¼Ð°Ñ”Ñˆ Ð¿Ñ€Ð°Ð²Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚Ð¸ Ð´Ñ–Ð°Ð»Ð¾Ð³. ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–:
"Ð•Ð¼...
"""

def is_question(message):
    return "?" in message or message.strip().lower().startswith((
        "Ð¿Ñ€Ð°Ñ†", "ÑÐº", "Ñ‡Ð¾Ð¼Ñƒ", "Ñ‡Ð¸", "ÑÐºÐ¸Ð¹", "ÑÐºÐ°", "ÑÐºÐµ", "Ñ€Ð¾Ð±",
        "Ð·Ð°Ð²Ð´Ð°Ð½", "Ð°ÐºÑƒÐ¼ÑƒÐ»ÑÑ‚Ð¾Ñ€", "Ð´Ñ–Ð°Ð¼ÐµÑ‚", "Ð¼ÐµÑ‚Ð°Ð»", "Ð·Ð°Ð´Ð°Ñ‡", "Ð¼ÐµÑ€ÐµÐ¶ÐµÐ²",
        "Ð´ÐµÑ€ÐµÐ²Ð¾", "Ð¼Ð°Ñ‚ÐµÑ€", "Ð½Ð°ÑÐ°Ð´ÐºÐ¸", "Ñ€ÐµÐ¶Ð¸Ð¼", "ÐºÑ€ÑƒÑ‚Ð½Ð¸Ð¹", "Ð¼Ð¾Ð¼ÐµÐ½Ñ‚",
        "Ð¿Ð¾Ñ‚ÑƒÐ¶Ð½", "Ð±ÑƒÐ´", "ÑÐ²ÐµÑ€"
    ))

def send_email_report(subject, body, to_email):
    msg = MIMEText(body, 'plain', 'utf-8')
    msg['Subject'] = subject
    msg['From'] = os.getenv('EMAIL_ADDRESS')
    msg['To'] = to_email

    try:
        with smtplib.SMTP(os.getenv('EMAIL_HOST'), int(os.getenv('EMAIL_PORT'))) as server:
            server.starttls()
            server.login(os.getenv('EMAIL_ADDRESS'), os.getenv('EMAIL_PASSWORD'))
            server.send_message(msg)
            print("[EMAIL] Ð—Ð²Ñ–Ñ‚ ÑƒÑÐ¿Ñ–ÑˆÐ½Ð¾ Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾.")
    except Exception as e:
        print(f"[EMAIL ERROR] ÐÐµ Ð²Ð´Ð°Ð»Ð¾ÑÑ Ð½Ð°Ð´Ñ–ÑÐ»Ð°Ñ‚Ð¸ Ð»Ð¸ÑÑ‚: {str(e)}")

@app.route('/authenticate', methods=['POST'])
def authenticate():
    seller_name = request.json.get("seller_name", "").strip()
    if not seller_name:
        return jsonify({"error": "Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð²Ð²ÐµÐ´Ñ–Ñ‚ÑŒ Ð²Ð°ÑˆÐµ ÐŸÐ†Ð‘"}), 400
    
    session['seller_name'] = seller_name
    session.modified = True
    return jsonify({"success": True, "message": f"Ð’Ñ–Ñ‚Ð°Ñ”Ð¼Ð¾, {seller_name}! Ð¢ÐµÐ¿ÐµÑ€ Ð²Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ñ€Ð¾Ð·Ð¿Ð¾Ñ‡Ð°Ñ‚Ð¸ Ð´Ñ–Ð°Ð»Ð¾Ð³."})

@app.errorhandler(500)
def internal_error(error):
    if 'seller_name' in session:
        generate_report(session)  # Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ Ð·Ð²Ñ–Ñ‚ Ð½Ð°Ð²Ñ–Ñ‚ÑŒ Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¼Ð¸Ð»Ñ†Ñ–
    return jsonify({"error": "Ð’Ð½ÑƒÑ‚Ñ€Ñ–ÑˆÐ½Ñ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°"}), 500

def init_conversation():
    # ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚Ð¸ Ð²ÑÑ– Ð¿Ð¾Ð¿ÐµÑ€ÐµÐ´Ð½Ñ– Ð´Ð°Ð½Ñ– ÑÐµÑÑ–Ñ—
    session.clear()
    
    selected_situation = random.choice(SITUATIONS)
    session['situation'] = selected_situation
    session['current_situation_id'] = selected_situation["id"]
    session['available_models'] = TOOL_MODELS.copy()  # Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ”Ð¼Ð¾ ÐºÐ¾Ð¿Ñ–ÑŽ, Ñ‰Ð¾Ð± ÑƒÐ½Ð¸ÐºÐ½ÑƒÑ‚Ð¸ Ð¼Ð¾Ð´Ð¸Ñ„Ñ–ÐºÐ°Ñ†Ñ–Ñ— Ð¾Ñ€Ð¸Ð³Ñ–Ð½Ð°Ð»Ñƒ
    session['stage'] = 1
    session['chat_active'] = True
    session['message_count'] = 0
    session['wrong_model_attempts'] = 0
    session['question_count'] = 0
    session['unique_questions'] = []
    session['off_topic_count'] = 0
    session['misunderstood_count'] = 0
    session['objection_round'] = 1
    session['warning_count'] = 0
    session['user_answers'] = {}
    session['question_scores'] = []
    session['model_score'] = 0
    session['total_score'] = 0
    session['seller_replies'] = []
    session['irrelevant_answers'] = 0
    session.modified = True 

    system_prompt = f"""
    Ð¢Ð¸ â€” Ð²Ñ–Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¸Ð¹ **ÐºÐ»Ñ–Ñ”Ð½Ñ‚ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñƒ**, ÑÐºÐ¸Ð¹ **Ð¿Ñ€Ð¸Ð¹ÑˆÐ¾Ð² ÐºÑƒÐ¿Ð¸Ñ‚Ð¸ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚**.  
    Ð¢Ð²Ð¾Ñ **Ñ”Ð´Ð¸Ð½Ð° Ð¼ÐµÑ‚Ð°** â€” **Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ñƒ Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–ÑŽ Ð´Ð»Ñ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸** Ð·Ð³Ñ–Ð´Ð½Ð¾ Ñ‚Ð²Ð¾Ñ”Ñ— ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–Ñ—.
    ÐÐµ Ð²Ð¸ÑÐ²Ñ–Ñ‚Ð»ÑŽÐ¹ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–ÑŽ Ð¿Ð¾Ð²Ð½Ñ–ÑÑ‚ÑŽ. ÐšÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ â€“ Ñ‚Ð¸ **Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ñ”Ñˆ Ð¿Ð¾ Ð¾Ð´Ð½Ð¾Ð¼Ñƒ Ñ€ÐµÑ‡ÐµÐ½Ð½ÑŽ**. 
    Ð¢Ð¸ **Ð½Ðµ Ñ” ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ð½Ñ‚Ð¾Ð¼**, **Ð½Ðµ Ð´Ð¾Ð¿Ð¾Ð¼Ð°Ð³Ð°Ñ”Ñˆ** ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ñƒ, **Ð½Ðµ Ð¿Ñ€Ð¾Ð¿Ð¾Ð½ÑƒÑ”Ñˆ Ð¼Ð¾Ð´ÐµÐ»Ñ–**, **Ð½Ðµ ÑÑ‚Ð°Ð²Ð¸Ñˆ Ð·ÑƒÑÑ‚Ñ€Ñ–Ñ‡Ð½Ð¸Ñ… Ð·Ð°Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ**.
    Ð¢Ð¸ Ð½Ðµ Ñ” ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ð½Ñ‚Ð¾Ð¼. Ð¢Ð¸ ÐºÐ»Ñ–Ñ”Ð½Ñ‚, ÑÐºÐ¸Ð¹ Ñ…Ð¾Ñ‡Ðµ Ð´Ñ–Ð·Ð½Ð°Ñ‚Ð¸ÑÑ Ð²ÑÐµ Ð½ÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ðµ Ð¿Ñ€Ð¾ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚, Ñ‰Ð¾Ð±Ð¸ Ð¿Ñ€Ð¸Ð¹Ð½ÑÑ‚Ð¸ Ñ€Ñ–ÑˆÐµÐ½Ð½Ñ Ð¿Ñ€Ð¾ Ð¿Ð¾ÐºÑƒÐ¿ÐºÑƒ.  
    Ð¢Ð¸ ÑƒÑ‚Ð¾Ñ‡Ð½ÑŽÑ”Ñˆ Ð´ÐµÑ‚Ð°Ð»Ñ–, Ð²Ð¸ÑÐ»Ð¾Ð²Ð»ÑŽÑ”Ñˆ ÑÐ²Ð¾Ñ— Ð²Ð¸Ð¼Ð¾Ð³Ð¸.
    **ÐÑ–ÐºÐ¾Ð»Ð¸ Ð½Ðµ Ð³Ñ€Ð°Ð¹ Ñ€Ð¾Ð»ÑŒ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ñ**.

    Ð¢Ð²Ð¾Ñ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–Ñ: {selected_situation['description']}
    Ð¢Ð²Ð¾Ñ— Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸: {selected_situation['requirements']}
    **ÐŸÐ¾Ð²ÐµÐ´Ñ–Ð½ÐºÐ°**: {selected_situation.get('behavior')}

    {UNACCEPTABLE_BEHAVIOR_PROMPT}

    ÐŸÐ¾Ð²ÐµÐ´Ñ–Ð½ÐºÐ°:
    - Ð¯ÐºÑ‰Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð³Ñ€ÑƒÐ±Ð¸Ð¹ Ð°Ð±Ð¾ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ” Ð»Ð°Ð¹Ð»Ð¸Ð²Ñƒ Ð»ÐµÐºÑÐ¸ÐºÑƒ â€” Ð·Ð°Ð²ÐµÑ€ÑˆÑƒÐ¹ Ð´Ñ–Ð°Ð»Ð¾Ð³ Ñ„Ñ€Ð°Ð·Ð¾ÑŽ "Ð¯ Ð’Ð°Ñ Ð½Ðµ Ð·Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ð²"
    - Ð’ Ñ–Ð½ÑˆÐ¾Ð¼Ñƒ Ð²Ð¸Ð¿Ð°Ð´ÐºÑƒ â€” Ð·Ð°Ð´Ð°Ð²Ð°Ð¹ Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ð·Ð°Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð°Ð±Ð¾ Ð²Ð¸ÑÐ»Ð¾Ð²Ð»ÑŽÐ¹ ÑÐ²Ð¾ÑŽ Ð´ÑƒÐ¼ÐºÑƒ.

    ÐŸÐ¾Ñ‡Ð¸Ð½Ð°Ð¹ Ñ€Ð¾Ð·Ð¼Ð¾Ð²Ñƒ Ð½ÐµÐ¹Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð¾:  
    "Ð”Ð¾Ð±Ñ€Ð¸Ð¹ Ð´ÐµÐ½ÑŒ, Ð¼ÐµÐ½Ñ– Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚."
    """
    return [
        {"role": "system", "content": system_prompt},
        {"role": "assistant", "content": f"Ð”Ð¾Ð±Ñ€Ð¸Ð¹ Ð´ÐµÐ½ÑŒ, Ð¼ÐµÐ½Ñ– Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±ÐµÐ½ {session['situation']['description']}"}
    ]

def is_relevant_question_gpt(question, situation_description):
    prompt = f"""
Ð¢Ð¸ â€” ÐºÐ»Ñ–Ñ”Ð½Ñ‚, ÑÐºÐ¸Ð¹ Ð¾Ð±Ð¸Ñ€Ð°Ñ” Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚.

ÐžÑ†Ñ–Ð½Ð¸, Ñ‡Ð¸ ÑÑ‚Ð¾ÑÑƒÑ”Ñ‚ÑŒÑÑ Ñ†Ðµ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð²Ð¸Ð±Ð¾Ñ€Ñƒ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ð¾Ð³Ð¾ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñƒ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ñ– Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¾Ñ— ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–Ñ—.

Ð¡Ð¸Ñ‚ÑƒÐ°Ñ†Ñ–Ñ: "{situation_description}"

ÐšÑ€Ð¸Ñ‚ÐµÑ€Ñ–Ñ— Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ð¾ÑÑ‚Ñ–:
- ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ Ð´Ð¾Ð¿Ð¾Ð¼Ð°Ð³Ð°Ñ” ÐºÑ€Ð°Ñ‰Ðµ Ð·Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ñ‚Ð¸ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸, Ð²Ð¸Ð¼Ð¾Ð³Ð¸ Ñ‡Ð¸ Ð¾Ð±Ð¼ÐµÐ¶ÐµÐ½Ð½Ñ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–Ñ—
- Ð’Ð¾Ð½Ð¾ ÑÑ‚Ð¾ÑÑƒÑ”Ñ‚ÑŒÑÑ Ñ‚ÐµÑ…Ð½Ñ–Ñ‡Ð½Ð¸Ñ… Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ–Ð², Ñ„ÑƒÐ½ÐºÑ†Ñ–Ð¹, ÑÑƒÐ¼Ñ–ÑÐ½Ð¾ÑÑ‚Ñ– Ð°Ð±Ð¾ Ð·Ð°ÑÑ‚Ð¾ÑÑƒÐ²Ð°Ð½Ð½Ñ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñƒ
- ÐÐ±Ð¾ Ð²Ð¾Ð½Ð¾ ÑƒÑ‚Ð¾Ñ‡Ð½ÑŽÑ” ÑƒÐ¼Ð¾Ð²Ð¸, Ð² ÑÐºÐ¸Ñ… Ð±ÑƒÐ´Ðµ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ²Ð°Ñ‚Ð¸ÑÑŒ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚

Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð¹ Ð»Ð¸ÑˆÐµ "Ñ‚Ð°Ðº" Ð°Ð±Ð¾ "Ð½Ñ–". ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ: "{question}"
"""

    try:
        response = openai.ChatCompletion.create(
            model="gpt-3.5-turbo",  # Ð°Ð±Ð¾ gpt-3.5-turbo, ÑÐºÑ‰Ð¾ Ñ‚Ñ€ÐµÐ±Ð°
            messages=[{"role": "user", "content": prompt}],
            temperature=0,
            max_tokens=10,
        )
        answer = response.choices[0].message["content"].strip().lower()
        print(f"[DEBUG] Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ GPT: {answer}")
        return "Ñ‚Ð°Ðº" in answer
    except Exception as e:
        print(f"ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ°: {str(e)}")
        return False

def match_model(user_input, available_models):
    user_model = re.sub(r'[^A-Z0-9-]', '', user_input.upper())
    matched_models = [m for m in available_models if user_model in m.upper()]
    
    if not matched_models:
        return None  # ÐœÐ¾Ð´ÐµÐ»ÑŒ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð°
    
    return matched_models[0]

@app.route('/')
def home():
    instance_id = request.args.get('instance')
    if instance_id:
        session['instance_id'] = instance_id  # Ð—Ð±ÐµÑ€Ñ–Ð³Ð°Ñ”Ð¼Ð¾ ID Ñ–Ð½ÑÑ‚Ð°Ð½ÑÑƒ Ð² ÑÐµÑÑ–Ñ—

@app.route('/start_chat')
def start_chat():
    session['history'] = init_conversation()
    # Ð¯ÐºÑ‰Ð¾ Ñ‚Ñ€ÐµÐ±Ð°, ÑÐºÐ¸Ð½ÑŒ Ñ–Ð½ÑˆÑ– Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸
    session["stage"] = 1
    session["question_count"] = 0
    session["model"] = None
    session["chat_active"] = True
    session["unique_questions"] = []

    return jsonify({
        "reply": session['history'][1]['content'],
        "avatar": session["situation"].get("avatar", "clientpes.png")
    })

@app.route("/restart-chat", methods=["POST"])
def restart_chat():
    keys_to_clear = [
        "history", "stage", "question_count", "model", "chat_active",
        "unique_questions", "misunderstood_count", "available_models",
        "wrong_model_attempts", "user_answers", "off_topic_count",
        "objection_round", "generated_questions", "current_question_index",
        "current_situation_id", "situation", "last_seller_reply",
        "current_objection", "hint_shown", "question_scores", "model_score", "total_score", "seller_replies"
    ]
    for key in keys_to_clear:
        session.pop(key, None)
    return jsonify({"message": "Ð¡ÐµÑÑ–ÑŽ ÑÐºÐ¸Ð½ÑƒÑ‚Ð¾."})

@app.route("/show_models", methods=["POST"])
def show_models():
    # ÐžÑ‚Ñ€Ð¸Ð¼ÑƒÑ”Ð¼Ð¾ Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ñƒ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–ÑŽ
    current_situation = session.get("situation")
    
    # ÐžÑ‚Ñ€Ð¸Ð¼ÑƒÑ”Ð¼Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ñ– Ð½ÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ– Ð¼Ð¾Ð´ÐµÐ»Ñ– Ð· Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ð¾Ñ— ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–Ñ—
    correct_models = current_situation["correct_models"]
    wrong_models = current_situation["wrong_models"]
    
    # Ð¤Ñ–Ð»ÑŒÑ‚Ñ€ÑƒÑ”Ð¼Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ– Ð¼Ð¾Ð´ÐµÐ»Ñ– Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ñ– ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–Ñ—
    available_models = correct_models + wrong_models

    session["stage"] = 2  # ÐŸÐµÑ€ÐµÐºÐ¾Ð½ÑƒÑ”Ð¼Ð¾ÑÑŒ, Ñ‰Ð¾ Ð¼Ð¸ Ð½Ð° Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¼Ñƒ ÐµÑ‚Ð°Ð¿Ñ– Ð´Ð»Ñ Ð²Ð¸Ð±Ð¾Ñ€Ñƒ Ð¼Ð¾Ð´ÐµÐ»Ñ–

    return jsonify({
        "models": available_models,
        "stage": 2
    })

def generate_report(session_data):
    seller_name = session_data.get('seller_name') or 'ÐÐµÐ²Ñ–Ð´Ð¾Ð¼Ð¸Ð¹ Ð¿Ñ€Ð¾Ð´Ð°Ð²ÐµÑ†ÑŒ'
    total_score = session_data.get('total_score', 0)
    max_score = 20  # Ð°Ð±Ð¾ Ñ–Ð½ÑˆÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ Ð· Ð²Ð°ÑˆÐ¾Ð³Ð¾ ÐºÐ¾Ð´Ñƒ
    
    report_lines = [
        f"Ð—Ð²Ñ–Ñ‚ Ð¿Ñ€Ð¾ Ð´Ñ–Ð°Ð»Ð¾Ð³ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ñ: {seller_name}",
        f"Ð”Ð°Ñ‚Ð°: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}",
        f"ÐžÑ†Ñ–Ð½ÐºÐ°: {total_score}/{max_score}",
        "\nÐ”Ñ–Ð°Ð»Ð¾Ð³:",
    ]
    
    # Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð²ÑÑ– Ñ€ÐµÐ¿Ð»Ñ–ÐºÐ¸ Ð´Ñ–Ð°Ð»Ð¾Ð³Ñƒ
    for message in session_data.get('conversation_log', []):
        role = "ÐšÐ»Ñ–Ñ”Ð½Ñ‚" if message['role'] == 'assistant' else "ÐŸÑ€Ð¾Ð´Ð°Ð²ÐµÑ†ÑŒ"
        report_lines.append(f"{role} ({message['timestamp']}): {message['message']}")
    
    # Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸ Ð¾Ñ†Ñ–Ð½ÑŽÐ²Ð°Ð½Ð½Ñ
    report_lines.extend([
        "\nÐ ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸:",
        f"- ÐžÑ†Ñ–Ð½ÐºÐ° Ð·Ð° Ð¼Ð¾Ð´ÐµÐ»ÑŒ: {session_data.get('model_score', 0)}/4",
        f"- ÐžÑ†Ñ–Ð½ÐºÐ° Ð·Ð° Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ: {sum(q['score'] for q in session_data.get('question_scores', []))}/5",
        f"- ÐžÑ†Ñ–Ð½ÐºÐ° Ð·Ð° Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–: {sum(a['score'] for a in session_data.get('user_answers', {}).values())}/6",
        f"- ÐžÑ†Ñ–Ð½ÐºÐ° Ð·Ð° Ð·Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½Ñ: {session_data.get('objection_score', 0)}/5"
    ])
    
    return "\n".join(report_lines)

@app.after_request
def apply_caching(response):
    response.headers["Cache-Control"] = "no-store, no-cache, must-revalidate, proxy-revalidate"
    response.headers["Pragma"] = "no-cache"
    response.headers["Expires"] = "0"
    response.headers["Set-Cookie"] = "SameSite=None; Secure"  # Ð”Ð¾Ð·Ð²Ð¾Ð»ÑÑ” ÑÐµÑÑ–ÑŽ Ñ‡ÐµÑ€ÐµÐ· iframe
    return response

@app.after_request
def set_security_headers(response):
    # ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ð´Ð»Ñ iframe
    response.headers['Content-Security-Policy'] = "frame-ancestors https://ako.dnipro-m.ua;"
    response.headers['X-Frame-Options'] = 'ALLOW-FROM https://ako.dnipro-m.ua'
    
    # Ð”Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ– Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¸ Ð±ÐµÐ·Ð¿ÐµÐºÐ¸
    response.headers['Referrer-Policy'] = 'strict-origin-when-cross-origin'
    response.headers['X-Content-Type-Options'] = 'nosniff'
    response.headers['Cache-Control'] = 'no-store, no-cache, must-revalidate'
    response.headers['Pragma'] = 'no-cache'
    
    # ÐšÑƒÐºÐ¸ Ð´Ð»Ñ iframe
    response.headers.add('Set-Cookie', 'SameSite=None; Secure')
    
    return response

@app.route("/chat", methods=["POST"])
def chat():
    instance_id = request.json.get('instance') or session.get('instance_id')
    if not instance_id:
        return jsonify({"error": "Instance ID missing"}), 400

    data = request.get_json()
    instance_id = data.get('instance') or session.get('instance_id')
    if not instance_id:
        return jsonify({"error": "Instance ID required"}), 400

    # Ð†Ð½Ñ–Ñ†Ñ–Ð°Ð»Ñ–Ð·Ð°Ñ†Ñ–Ñ Ð²ÑÑ–Ñ… ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ð¸Ñ… Ð·Ð¼Ñ–Ð½Ð½Ð¸Ñ… ÑÐµÑÑ–Ñ—
    session.setdefault('conversation_log', [])
    session.setdefault('seller_name', request.json.get("seller_name", "ÐÐµÐ²Ñ–Ð´Ð¾Ð¼Ð¸Ð¹ Ð¿Ñ€Ð¾Ð´Ð°Ð²ÐµÑ†ÑŒ"))
    session.setdefault('stage', 1)
    session.setdefault('misunderstood_count', 0)
    session.setdefault('objection_round', 1)
    session.setdefault('question_scores', [])
    session.setdefault('user_answers', {})
    session.setdefault('seller_replies', [])
    session.setdefault('available_models', [])
    session.setdefault('history', init_conversation() if 'history' not in session else session['history'])

    user_input = request.json.get("message", "").strip()
    print(f"[DEBUG] ÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ ÑÑ‚Ð°Ð½ ÑÐµÑÑ–Ñ—: {list(session.keys())}")
    print(f"[DEBUG] ÐšÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡ Ð½Ð°Ð¿Ð¸ÑÐ°Ð²: {user_input}")
    print(f"[DEBUG] ÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð° ÑÑ‚Ð°Ð´Ñ–Ñ: {session['stage']}")

    # Ð—Ð°Ð¿Ð¸Ñ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð² Ð»Ð¾Ð³
    try:
        session['conversation_log'].append({
            'role': 'user',
            'message': user_input,
            'timestamp': datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        })
        session.modified = True
        print(f"[DEBUG] ÐžÐ½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ conversation_log: {session['conversation_log'][-1]}")
    except Exception as e:
        print(f"[ERROR] ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð·Ð°Ð¿Ð¸ÑÑƒ Ð² conversation_log: {str(e)}")
        session['conversation_log'] = [{
            'role': 'user', 
            'message': user_input,
            'timestamp': datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        }]

    if "history" not in session or not session["history"]:
        session["history"] = init_conversation()
        session["stage"] = 1
        session["question_count"] = 0
        session["model"] = None
        session["chat_active"] = True
        session["unique_questions"] = []
        session["misunderstood_count"] = 0
        session["wrong_model_attempts"] = 0
        session["model_score"] = 0
        session["total_score"] = 0
        session["objection_round"] = 1

        # --- Stage 1: ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð° ---
    if session["stage"] == 1:
        # ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ð½Ð° Ð½ÐµÑ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ñ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ
        if not is_relevant_question_gpt(user_input, session["situation"]["description"]):
            print(f"[SCORE] ÐÐµÑ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ðµ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ: 0 Ð±Ð°Ð»Ñ–Ð² | ÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ Ñ€Ð°Ñ…ÑƒÐ½Ð¾Ðº: {session.get('total_score', 0)}")
            session["misunderstood_count"] += 1
            session["question_scores"].append({"question": user_input, "score": 0})
            
            # Ð—Ð±Ñ–Ð»ÑŒÑˆÑƒÑ”Ð¼Ð¾ Ð·Ð°Ð³Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð»Ñ–Ñ‡Ð¸Ð»ÑŒÐ½Ð¸Ðº Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ, Ð½Ð°Ð²Ñ–Ñ‚ÑŒ ÑÐºÑ‰Ð¾ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð½ÐµÑ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ðµ
            session["question_count"] += 1

            if session["misunderstood_count"] >= 3:
                session["chat_active"] = False
                # Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ñ–Ñ Ð·Ð²Ñ–Ñ‚Ñƒ Ñ‚Ð° Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ Ð¹Ð¾Ð³Ð¾ Ð² Ð·Ð¼Ñ–Ð½Ð½Ñƒ report_content
                report_content = generate_report(session)  # Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ Ð·Ð²Ñ–Ñ‚ Ð½Ð°Ð²Ñ–Ñ‚ÑŒ Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¼Ð¸Ð»Ñ†Ñ–
                send_email_report(
                    subject=f"Ð—Ð²Ñ–Ñ‚ Ð¿Ñ€Ð¾ Ð´Ñ–Ð°Ð»Ð¾Ð³ â€” {session.get('seller_name', 'ÐŸÑ€Ð¾Ð´Ð°Ð²ÐµÑ†ÑŒ')}",
                    body=report_content,  # Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ”Ð¼Ð¾ Ð·Ð³ÐµÐ½ÐµÑ€Ð¾Ð²Ð°Ð½Ð¸Ð¹ Ð·Ð²Ñ–Ñ‚
                    to_email="voloshchenko2014@gmail.com"
                )
                return jsonify({
                    "reply": "Ð’Ð¸ Ð¿Ð¾ÑÑ‚Ð°Ð²Ð¸Ð»Ð¸ Ð´ÐµÐºÑ–Ð»ÑŒÐºÐ° Ð½ÐµÑ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ð¸Ñ… Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ. Ð”Ñ–Ð°Ð»Ð¾Ð³ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾.",
                    "chat_ended": True,
                    "show_restart_button": True
                })
            return jsonify({
                "reply": "Ð’Ð°ÑˆÐµ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð½Ðµ ÑÑ‚Ð¾ÑÑƒÑ”Ñ‚ÑŒÑÑ Ð²Ð¸Ð±Ð¾Ñ€Ñƒ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñƒ. Ð¡Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ñ–Ð½ÑˆÐµ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ.",
                "chat_ended": False,
                "question_progress": session["question_count"]
            })

        # ÐžÐ±Ñ€Ð¾Ð±ÐºÐ° Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ð¸Ñ… Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ
        is_duplicate = user_input.lower() in [q.lower() for q in session["unique_questions"]]
        question_score = 1 if not is_duplicate else 0
        print(f"[SCORE] {'ÐÐ¾Ð²Ðµ' if not is_duplicate else 'ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ðµ'} Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ: +{question_score} Ð±Ð°Ð»(Ð¸)")
        
        if not is_duplicate:
            session["unique_questions"].append(user_input)

        session["question_scores"].append({
            "question": user_input,
            "score": question_score
        })
        
        # Ð—Ð±Ñ–Ð»ÑŒÑˆÑƒÑ”Ð¼Ð¾ Ð·Ð°Ð³Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð»Ñ–Ñ‡Ð¸Ð»ÑŒÐ½Ð¸Ðº Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ Ð·Ð° ÐºÐ¾Ð¶Ð½Ðµ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ
        session["question_count"] += 1

        current_questions_score = sum(q["score"] for q in session["question_scores"])
        max_questions_score = 5  # Ð¢ÐµÐ¿ÐµÑ€ Ñ€Ð°Ñ…ÑƒÑŽÑ‚ÑŒÑÑ Ð²ÑÑ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ, Ð½Ðµ Ñ‚Ñ–Ð»ÑŒÐºÐ¸ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ–
        print(f"[SCORE] Ð—Ð°Ð³Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð±Ð°Ð» Ð·Ð° Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ: {current_questions_score}/{max_questions_score}")

        # ÐžÐ±Ð¼ÐµÐ¶ÐµÐ½Ð½Ñ ÐºÑ–Ð»ÑŒÐºÐ¾ÑÑ‚Ñ– Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ (Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 5)
        if session["question_count"] >= 7:
            session["stage"] = 2
            return jsonify({
                "reply": "Ð¯ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð² Ð½Ð° Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð½ÑŒÐ¾ Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ. Ð¢ÐµÐ¿ÐµÑ€ Ð²Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð·Ð°Ð¿Ñ€Ð¾Ð¿Ð¾Ð½ÑƒÐ²Ð°Ñ‚Ð¸ Ð¼ÐµÐ½Ñ– Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñƒ.",
                "chat_ended": False,
                "stage": 2,
                "show_model_button": True
            })

        # Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ñ–Ñ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– GPT
        now = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

        # Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° Ð´Ð¾ history Ñ– Ð´Ð¾ conversation_log
        session["history"].append({"role": "user", "content": user_input})
        session['conversation_log'].append({
            'role': 'user',
            'message': user_input,
            'timestamp': now
        })

        try:
            response = openai.ChatCompletion.create(
                model="gpt-3.5-turbo",
                messages=session["history"][-20:],
                temperature=0.5,
                max_tokens=150
            )
            answer = response.choices[0].message["content"].strip()

            # Ð”Ð¾Ð´Ð°Ñ‚Ð¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ GPT Ð´Ð¾ history Ñ– Ð´Ð¾ conversation_log
            session["history"].append({"role": "assistant", "content": answer})
            session['conversation_log'].append({
                'role': 'assistant',
                'message': answer,
                'timestamp': datetime.now().strftime("%Y-%m-%d %H:%M:%S")
            })

            return jsonify({
                "reply": answer,
                "chat_ended": False,
                "stage": 1,
                "question_progress": session["question_count"],
                "show_model_button": session["question_count"] >= 3
            })
        except Exception as e:
            return jsonify({
                "reply": "Ð’Ð¸Ð±Ð°Ñ‡Ñ‚Ðµ, ÑÑ‚Ð°Ð»Ð°ÑÑ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–. Ð¡Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ñ‰Ðµ Ñ€Ð°Ð·.",
                "chat_ended": False
            })

    # --- Stage 2: Ð’Ð¸Ð±Ñ–Ñ€ Ð¼Ð¾Ð´ÐµÐ»Ñ– ---
    elif session["stage"] == 2:
        user_model = re.sub(r'[^A-Z0-9-]', '', user_input.upper())
        matched_models = [m for m in session["available_models"] if user_model in m.upper()]

        if not matched_models:
            session["model_score"] = 0
            session["wrong_model_attempts"] += 1
            session["stage"] = 3
            return jsonify({
                "reply": "Ð¦Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ð½Ðµ Ð¿Ñ–Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ð´Ð»Ñ Ð¼Ð¾Ñ—Ñ… Ð¿Ð¾Ñ‚Ñ€ÐµÐ±. Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¾Ð´Ð¾Ð²Ð¶Ð¸Ð¼Ð¾.",
                "chat_ended": False,
                "stage": 3,
                "model_chosen": False  # Ð”Ð¾Ð´Ð°Ð¹Ñ‚Ðµ Ñ†ÐµÐ¹ Ð¿Ñ€Ð°Ð¿Ð¾Ñ€ÐµÑ†ÑŒ
            })

        user_model = matched_models[0].upper()
        current_situation = next((s for s in SITUATIONS if s["id"] == session.get("current_situation_id")), None)
        if not current_situation:
            return jsonify({
                "reply": "ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ°: ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ñ–Ñ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð°.",
                "chat_ended": True,
                "show_restart_button": True
            })

        correct_models = [model.upper() for model in current_situation["correct_models"]]
        partially_correct_models = [model.upper() for model in current_situation.get("partially_correct_models", [])]

        # ÐžÑ†Ñ–Ð½ÐºÐ° Ð¼Ð¾Ð´ÐµÐ»Ñ–
        if user_model in correct_models:
            session["model_score"] = 4
            print(f"[SCORE] ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð° Ð¼Ð¾Ð´ÐµÐ»ÑŒ: +2 Ð±Ð°Ð»Ð¸")
        elif user_model in partially_correct_models:
            session["model_score"] = 1
            print(f"[SCORE] Ð§Ð°ÑÑ‚ÐºÐ¾Ð²Ð¾ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð° Ð¼Ð¾Ð´ÐµÐ»ÑŒ: +1 Ð±Ð°Ð»")
        else:
            session["model_score"] = 0
            print(f"[SCORE] ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð° Ð¼Ð¾Ð´ÐµÐ»ÑŒ: 0 Ð±Ð°Ð»Ñ–Ð²")

            # ÐžÐ½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ Ð²Ð¸Ð²Ñ–Ð´ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ñƒ Ð½Ð° stage 3
            print(f"[SCORE] ÐŸÐ¾Ñ‚Ð¾Ñ‡Ð½Ð¸Ð¹ Ð±Ð°Ð» Ð·Ð° Ð¼Ð¾Ð´ÐµÐ»ÑŒ: {session['model_score']}/2")
            print(f"[SCORE] Ð—Ð°Ð³Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð±Ð°Ð»: {session.get('total_score', 0) + session['model_score']}")

        # ÐŸÐµÑ€ÐµÑ…Ð¾Ð´ÑŒ Ð½Ð° stage 3 Ð¿Ñ–ÑÐ»Ñ Ð¾Ñ†Ñ–Ð½ÐºÐ¸ Ð¼Ð¾Ð´ÐµÐ»Ñ–
        session["model"] = user_model
        session["stage"] = 3
        session["current_question_index"] = 0
        session["user_answers"] = {}

        # Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ñ–Ñ ÑƒÑ‚Ð¾Ñ‡Ð½ÑŽÑŽÑ‡Ð¸Ñ… Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ
        prompt = f"""Ð¢Ð¸ ÐºÐ»Ñ–Ñ”Ð½Ñ‚, ÑÐºÐ¸Ð¹ Ð¾Ð±Ñ€Ð°Ð² Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ {user_model} Ð´Ð»Ñ {session['situation']['description']}.\n
        Ð—Ð³ÐµÐ½ÐµÑ€ÑƒÐ¹ 3 Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð¿Ñ€Ð¾ **Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÐ¸**, **Ð·Ð¾Ð²Ð½Ñ–ÑˆÐ½ÑŽ Ð±ÑƒÐ´Ð¾Ð²Ñƒ** Ñ‚Ð° Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— Ñ†ÑŒÐ¾Ð³Ð¾ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñƒ."""

        try:
            response = openai.ChatCompletion.create(
                model="gpt-3.5-turbo",
                messages=[
                    {"role": "system", "content": "Ð¢Ð¸ â€” ÐºÐ»Ñ–Ñ”Ð½Ñ‚, ÑÐºÐ¸Ð¹ Ð¼Ð°Ñ” Ð·Ð°Ð´Ð°Ñ‚Ð¸ ÑƒÑ‚Ð¾Ñ‡Ð½ÑŽÑŽÑ‡Ñ– Ð·Ð°Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð¿Ñ€Ð¾ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð°."},
                    {"role": "user", "content": prompt}
                ],
                temperature=0.6,
                max_tokens=400
            )
            content = response.choices[0].message.get("content", "")
            questions = [line.strip(" 1234567890.-") for line in content.split('\n') if line.strip()]
            session["generated_questions"] = questions
            
            session["history"].append({"role": "user", "content": user_input})
            first_question = questions[0] if questions else "Ð¯ÐºÐµ Ð¿ÐµÑ€ÑˆÐµ Ð²Ð°ÑˆÐµ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð¿Ñ€Ð¾ Ñ†ÑŽ Ð¼Ð¾Ð´ÐµÐ»ÑŒ?"
            session["history"].append({"role": "assistant", "content": first_question})

            session.modified = True

            return jsonify({
                "reply": f"Ð”Ð¾Ð±Ñ€Ðµ, {user_model} Ð²Ð¸Ð³Ð»ÑÐ´Ð°Ñ” Ð½ÐµÐ¿Ð¾Ð³Ð°Ð½Ð¾. Ð Ñ‚Ð°ÐºÐµ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ:\n\n{first_question}",
                "chat_ended": False,
                "stage": 3
            })
        except Exception as e:
            return jsonify({
                "reply": "Ð’Ð¸Ð±Ð°Ñ‡Ñ‚Ðµ, ÑÑ‚Ð°Ð»Ð°ÑÑ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ñ–Ñ— Ð¿Ð¸Ñ‚Ð°Ð½ÑŒ. Ð¡Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ñ‰Ðµ Ñ€Ð°Ð·.",
                "chat_ended": False
            })


    # --- Stage 3: Ð£Ñ‚Ð¾Ñ‡Ð½ÑŽÑŽÑ‡Ñ– Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ ---
    elif session["stage"] == 3:
        if 'generated_questions' not in session:
            return jsonify({
                "reply": "ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ñ–. Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ð¿Ð¾Ñ‡Ð½ÐµÐ¼Ð¾ ÑÐ¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ.",
                "chat_ended": True,
                "show_restart_button": True
            })

        index = session.get('current_question_index', 0)
        current_question = session['generated_questions'][index]

        session["history"].append({"role": "user", "content": user_input})

        # ÐžÑ†Ñ–Ð½ÐºÐ° Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–
        gpt_prompt = f"""
ÐžÑ†Ñ–Ð½Ð¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð° Ð½Ð° Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ.
ÐŸÐ¸Ñ‚Ð°Ð½Ð½Ñ: "{current_question}"
Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ: "{user_input}"

ÐžÑ†Ñ–Ð½Ð¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ñ Ð·Ð° Ñ†Ñ–Ñ”ÑŽ ÑˆÐºÐ°Ð»Ð¾ÑŽ:

2 â€” Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ **Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÑƒ** Ñ– Ð¿Ð¾ÑÑÐ½ÐµÐ½Ð½Ñ, Ñ‰Ð¾ Ð²Ð¾Ð½Ð° Ð¾Ð·Ð½Ð°Ñ‡Ð°Ñ” Ð°Ð±Ð¾ ÑÐº Ð´Ð¾Ð¿Ð¾Ð¼Ð°Ð³Ð°Ñ” ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ñƒ
1 â€” Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ Ð¼Ñ–ÑÑ‚Ð¸Ñ‚ÑŒ **Ð»Ð¸ÑˆÐµ Ñ…Ð°Ñ€Ð°ÐºÑ‚ÐµÑ€Ð¸ÑÑ‚Ð¸ÐºÑƒ**
0 â€” Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ **Ð½Ðµ Ð¿Ð¾ Ñ‚ÐµÐ¼Ñ–** Ð°Ð±Ð¾ **Ð·Ð°Ð½Ð°Ð´Ñ‚Ð¾ Ð·Ð°Ð³Ð°Ð»ÑŒÐ½Ð°**

Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð¹ Ð»Ð¸ÑˆÐµ Ñ†Ð¸Ñ„Ñ€Ð¾ÑŽ: 0, 1 Ð°Ð±Ð¾ 2.
"""
        try:
            evaluation = openai.ChatCompletion.create(
                model="gpt-3.5-turbo",
                messages=[
                    {"role": "system", "content": "Ð¢Ð¸ Ð¾Ñ†Ñ–Ð½ÑŽÑ”Ñˆ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ Ð½Ð° Ð·Ð°Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ. Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð¹ Ð»Ð¸ÑˆÐµ Ñ‡Ð¸ÑÐ»Ð¾Ð¼: 0, 1 Ð°Ð±Ð¾ 2."},
                    {"role": "user", "content": gpt_prompt}
                ],
                temperature=0,
                max_tokens=10
            )
            score = int(evaluation.choices[0].message["content"].strip() or 0)
            print(f"[SCORE] Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ Ð½Ð° Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ {session['current_question_index']+1}: {score}/2 Ð±Ð°Ð»Ñ–Ð²")

            # Ð—Ð±ÐµÑ€Ñ–Ð³Ð°Ñ”Ð¼Ð¾ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ
            session["user_answers"][current_question] = {
                "answer": user_input,
                "score": score
            }

            # ðŸ”´ Ð›Ñ–Ñ‡Ð¸Ð»ÑŒÐ½Ð¸Ðº Ð´Ð²Ð¾Ñ… Ð¿Ð¾ÑÐ¿Ñ–Ð»ÑŒ Ð½ÐµÑ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ð¸Ñ… Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÐµÐ¹
            if score == 0:
                session['irrelevant_answers'] = session.get('irrelevant_answers', 0) + 1
            else:
                session['irrelevant_answers'] = 0  # ÑÐºÐ¸Ð´Ð°Ñ”Ð¼Ð¾ Ð»Ñ–Ñ‡Ð¸Ð»ÑŒÐ½Ð¸Ðº Ð¿Ñ€Ð¸ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ñ–Ð¹ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–

            if session['irrelevant_answers'] >= 2:
                session['chat_active'] = False
                report_content = generate_report(session)  # Ð—Ð±ÐµÑ€ÐµÐ³Ñ‚Ð¸ Ð·Ð²Ñ–Ñ‚ Ð½Ð°Ð²Ñ–Ñ‚ÑŒ Ð¿Ñ€Ð¸ Ð¿Ð¾Ð¼Ð¸Ð»Ñ†Ñ–
                send_email_report(
                    subject=f"Ð—Ð²Ñ–Ñ‚ Ð¿Ñ€Ð¾ Ð´Ñ–Ð°Ð»Ð¾Ð³ â€” {session.get('seller_name', 'ÐŸÑ€Ð¾Ð´Ð°Ð²ÐµÑ†ÑŒ')}",
                    body=report_content,
                    to_email="voloshchenko2014@gmail.com"
                )
                return jsonify({
                    "reply": "Ð’Ð¸Ð±Ð°Ñ‡Ñ‚Ðµ, Ñ Ð½Ðµ Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð² Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾Ñ— Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ—. Ð¯, Ð¼Ð°Ð±ÑƒÑ‚ÑŒ, Ð¿Ñ–Ð´Ñƒ Ð² Ñ–Ð½ÑˆÐ¸Ð¹ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½.",
                    "chat_ended": True,
                    "show_restart_button": True
                })

            # ÐŸÑ€Ð¾Ð´Ð¾Ð²Ð¶ÑƒÑ”Ð¼Ð¾ Ð´Ñ–Ð°Ð»Ð¾Ð³
            current_answers_score = sum(a["score"] for a in session["user_answers"].values())
            max_answers_score = 3 * 2  # 3 Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð¿Ð¾ 2 Ð±Ð°Ð»Ð¸
            print(f"[SCORE] Ð—Ð°Ð³Ð°Ð»ÑŒÐ½Ð¸Ð¹ Ð±Ð°Ð» Ð·Ð° Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–: {current_answers_score}/{max_answers_score}")

            session['current_question_index'] += 1

            # ÐŸÐµÑ€ÐµÑ…Ñ–Ð´ Ð´Ð¾ Ð½Ð°ÑÑ‚ÑƒÐ¿Ð½Ð¾Ð³Ð¾ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ
            if session['current_question_index'] < len(session['generated_questions']):
                next_question = session['generated_questions'][session['current_question_index']]
                session["history"].append({"role": "assistant", "content": next_question})
                session.modified = True

                return jsonify({
                    "reply": next_question,
                    "chat_ended": False
                })
            else:
                # ÐŸÐµÑ€ÐµÑ…Ñ–Ð´ Ð´Ð¾ Stage 4 (Ð·Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½Ñ)
                session["stage"] = 4
                answers_score = sum(a["score"] for a in session["user_answers"].values())

                if answers_score >= 5:
                    feedback = "Ð“Ð°Ñ€Ð½Ð¸Ð¹ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚."
                elif answers_score >= 3:
                    feedback = "Ð†Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚ Ð½ÐµÐ¿Ð¾Ð³Ð°Ð½Ð¸Ð¹."
                else:
                    feedback = "Ð—Ñ€Ð¾Ð·ÑƒÐ¼Ñ–Ð»Ð¾."

                objections = [
                    "ÐœÐµÐ½Ñ– Ð·Ð´Ð°Ñ”Ñ‚ÑŒÑÑ, Ñ†Ðµ Ñ‚Ñ€Ð¾Ñ…Ð¸ Ð´Ð¾Ñ€Ð¾Ð³ÑƒÐ²Ð°Ñ‚Ð¾.",
                    "Ð’Ð°ÑˆÐ° Ð³Ð°Ñ€Ð°Ð½Ñ‚Ñ–Ñ Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¿Ñ€Ð°Ñ†ÑŽÑ”?",
                    "Ð¯ Ð±Ð°Ñ‡Ð¸Ð² Ð² Ñ–Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ñ– Ð´ÐµÑˆÐµÐ²ÑˆÐµ.",
                    "Ð§Ð¾Ð¼Ñƒ Ð² ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚Ñ– Ñ‚Ð°Ðº Ð¼Ð°Ð»Ð¾ Ð½Ð°ÑÐ°Ð´Ð¾Ðº?",
                    "Ð¯ Ñ‡ÑƒÐ², Ñ‰Ð¾ Ñ†Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ ÑˆÐ²Ð¸Ð´ÐºÐ¾ Ð»Ð°Ð¼Ð°Ñ”Ñ‚ÑŒÑÑ.",
                    "Ð£ Ñ–Ð½ÑˆÐ¾Ð¼Ñƒ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñ– Ñ‚Ð°ÐºÐ° Ð¶ Ð¼Ð¾Ð´ÐµÐ»ÑŒ, Ð°Ð»Ðµ Ð·Ñ– Ð·Ð½Ð¸Ð¶ÐºÐ¾ÑŽ.",
                    "Ð¦Ðµ Ð¾ÑÑ‚Ð°Ð½Ð½Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ñ‡Ð¸ Ð²Ð¶Ðµ Ð·Ð°ÑÑ‚Ð°Ñ€Ñ–Ð»Ð°?",
                    "Ð Ð´Ðµ Ð²Ð¸Ñ€Ð¾Ð±Ð»ÑÑŽÑ‚ÑŒ Ñ†ÐµÐ¹ Ñ–Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚?",
                    "Ð¯ Ñ‡ÑƒÐ² Ð¿Ð¾Ð³Ð°Ð½Ñ– Ð²Ñ–Ð´Ð³ÑƒÐºÐ¸ Ð¿Ñ€Ð¾ Ñ†ÑŽ Ð¼Ð¾Ð´ÐµÐ»ÑŒ.",
                    "Ð ÑÐºÑ‰Ð¾ Ð¼ÐµÐ½Ñ– Ð½Ðµ ÑÐ¿Ð¾Ð´Ð¾Ð±Ð°Ñ”Ñ‚ÑŒÑÑ - Ð¼Ð¾Ð¶Ð½Ð° Ð¿Ð¾Ð²ÐµÑ€Ð½ÑƒÑ‚Ð¸?"
                ]
                session["current_objection"] = random.choice(objections)
                session["objection_round"] = 1

                final_reply = f"{feedback}\n\nÐ¥Ð¼... {session['current_objection']}"
                session["history"].append({"role": "assistant", "content": final_reply})
                session.modified = True

                return jsonify({
                    "reply": f"{feedback}\n\nÐ¥Ð¼... {session['current_objection']}",
                    "chat_ended": False,
                    "stage": 4
                })
        except Exception as e:
            return jsonify({
                "reply": "Ð’Ð¸Ð½Ð¸ÐºÐ»Ð° Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ†Ñ–Ð½ÑŽÐ²Ð°Ð½Ð½Ñ– Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–. Ð¡Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ñ‰Ðµ Ñ€Ð°Ð·.",
                "chat_ended": False
            })

    # --- Stage 4: ÐžÐ±Ñ€Ð¾Ð±ÐºÐ° Ð·Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½ÑŒ ---
    elif session["stage"] == 4:
        objection = session.get("current_objection", "Ð—Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½Ñ")
        seller_reply = user_input
        session["seller_replies"].append(seller_reply)
        current_round = session.get("objection_round", 1)

        if current_round <= 2:
            try:
                history = "\n".join([f"Ð Ð°ÑƒÐ½Ð´ {i+1}: {reply}" for i, reply in enumerate(session["seller_replies"])])
                gpt_prompt = f"""
    Ð¢Ð¸ â€” ÐºÐ»Ñ–Ñ”Ð½Ñ‚, ÑÐºÐ¸Ð¹ Ð¼Ð°Ñ” Ð·Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½Ñ: "{objection}".

    ÐžÑÑŒ ÑÐº Ð¿Ñ€Ð¾Ð´Ð°Ð²ÐµÑ†ÑŒ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð² Ð´Ð¾ Ñ†ÑŒÐ¾Ð³Ð¾ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ñƒ:
    {history}

    Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð¹ ÑÐº Ñ€ÐµÐ°Ð»Ñ–ÑÑ‚Ð¸Ñ‡Ð½Ð¸Ð¹ ÐºÐ»Ñ–Ñ”Ð½Ñ‚. Ð ÐµÐ°Ð³ÑƒÐ¹ Ð¿Ñ€Ð¸Ñ€Ð¾Ð´Ð½Ð¾ Ð½Ð° Ð¾ÑÑ‚Ð°Ð½Ð½ÑŽ Ñ€ÐµÐ¿Ð»Ñ–ÐºÑƒ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ñ: "{seller_reply}".
    ÐŸÑ–Ð´Ñ‚Ñ€Ð¸Ð¼ÑƒÐ¹ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð·Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½Ñ. Ð‘ÑƒÐ´ÑŒ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¸Ð¼, Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð¹ Ð¾Ð´Ð½Ð¸Ð¼-Ð´Ð²Ð¾Ð¼Ð° Ñ€ÐµÑ‡ÐµÐ½Ð½ÑÐ¼Ð¸."""
                
                response = openai.ChatCompletion.create(
                    model="gpt-3.5-turbo",
                    messages=[
                        {"role": "system", "content": "Ð¢Ð¸ â€” ÐºÐ»Ñ–Ñ”Ð½Ñ‚ Ñƒ Ð´Ñ–Ð°Ð»Ð¾Ð·Ñ– Ð· Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†ÐµÐ¼. Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð¹ Ñ‡ÐµÑÐ½Ð¾, Ð»Ð¾Ð³Ñ–Ñ‡Ð½Ð¾ Ñ– Ð·Ð³Ñ–Ð´Ð½Ð¾ Ð· ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼ Ð·Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½Ñ."},
                        {"role": "user", "content": gpt_prompt}
                    ],
                    temperature=0.6,
                    max_tokens=200
                )
                reply = response.choices[0].message["content"].strip()
                session["objection_round"] += 1
                session.modified = True

                return jsonify({
                    "reply": reply,
                    "chat_ended": False,
                    "current_round": session["objection_round"]
                })
            except Exception as e:
                return jsonify({
                    "reply": "Ð’Ð¸Ð±Ð°Ñ‡Ñ‚Ðµ, ÑÑ‚Ð°Ð»Ð°ÑÑ Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ–Ð´ Ñ‡Ð°Ñ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–. Ð¡Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ñ‰Ðµ Ñ€Ð°Ð·.",
                    "chat_ended": False
                })

        elif current_round == 3:
            try:
                if not session.get("seller_replies"):
                    return jsonify({
                        "reply": "ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ°: Ð²Ñ–Ð´ÑÑƒÑ‚Ð½Ñ– Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– Ð´Ð»Ñ Ð¾Ñ†Ñ–Ð½ÑŽÐ²Ð°Ð½Ð½Ñ.",
                        "chat_ended": True,
                        "show_restart_button": True
                    })

                full_history = "\n".join([f"Ð Ð°ÑƒÐ½Ð´ {i+1}: {reply}" for i, reply in enumerate(session["seller_replies"])])
                evaluation_prompt = f"""
    Ð¢Ð¸ â€” ÐµÐºÑÐ¿ÐµÑ€Ñ‚ Ð· Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ñ–Ð², ÑÐºÐ¸Ð¹ Ð¾Ñ†Ñ–Ð½ÑŽÑ” Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ñ Ð½Ð° Ð·Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½Ñ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°.

    Ð—Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½Ñ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°: "{objection}"

    ÐžÑÑŒ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ñ (Ð¿Ð¾ Ñ€Ð°ÑƒÐ½Ð´Ð°Ñ…):
    {full_history}

    ÐŸÑ€Ð¾Ð°Ð½Ð°Ð»Ñ–Ð·ÑƒÐ¹ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ñ Ð·Ð° 4 ÐºÑ€Ð¸Ñ‚ÐµÑ€Ñ–ÑÐ¼Ð¸:
    1. Ð§Ñ–Ñ‚ÐºÑ–ÑÑ‚ÑŒ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ–Ð²
    2. Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð½Ñ–ÑÑ‚ÑŒ Ð·Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½ÑŽ
    3. ÐÐ°ÑÐ²Ð½Ñ–ÑÑ‚ÑŒ Ð´Ð¾ÐºÐ°Ð·Ñ–Ð², Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ñ–Ð² Ð°Ð±Ð¾ Ð»Ð¾Ð³Ñ–ÐºÐ¸
    4. Ð›Ð¾Ð³Ñ–Ñ‡Ð½Ð° Ð¿Ð¾ÑÐ»Ñ–Ð´Ð¾Ð²Ð½Ñ–ÑÑ‚ÑŒ Ñ– Ð¿Ð¾Ð±ÑƒÐ´Ð¾Ð²Ð°

    ÐÑ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚ â€” Ñ†Ðµ Ñ‡Ñ–Ñ‚ÐºÐµ Ð¿Ð¾ÑÑÐ½ÐµÐ½Ð½Ñ Ð· Ð´Ð¾ÐºÐ°Ð·Ð¾Ð¼, Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´Ð¾Ð¼ Ð°Ð±Ð¾ Ð»Ð¾Ð³Ñ–ÐºÐ¾ÑŽ, ÑÐºÐµ Ð¿Ñ€ÑÐ¼Ð¾ ÑÑ‚Ð¾ÑÑƒÑ”Ñ‚ÑŒÑÑ Ð·Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½Ñ.

    ðŸ”» ÐžÑ†Ñ–Ð½Ð¸ Ñ€Ñ–Ð²ÐµÐ½ÑŒ Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾ÑÑ‚Ñ– Ð·Ð° ÑˆÐºÐ°Ð»Ð¾ÑŽ:
    - "Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾" â€” ÑÐºÑ‰Ð¾ Ñ” **1 Ð°Ð±Ð¾ Ð±Ñ–Ð»ÑŒÑˆÐµ ÑÐ¸Ð»ÑŒÐ½Ñ– Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¸** â€“ 5 Ð±Ð°Ð»Ñ–Ð²
    - "Ñ‡Ð°ÑÑ‚ÐºÐ¾Ð²Ð¾ Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾" â€” ÑÐºÑ‰Ð¾ Ñ” **2 ÑÐ»Ð°Ð±ÐºÐ¸Ñ… Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ð¸** â€“ 3 Ð±Ð°Ð»Ð¸
    - "Ð½ÐµÐ¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾" â€” ÑÐºÑ‰Ð¾ **Ð½ÐµÐ¼Ð°Ñ”** Ð¶Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñƒ Ð°Ð±Ð¾ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ Ð½Ðµ Ð¿Ð¾ Ñ‚ÐµÐ¼Ñ– â€“ 0 Ð±Ð°Ð»Ñ–Ð²

    Ð’Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ð°Ð¹ Ð¾Ð´Ð½Ð¸Ð¼ ÑÐ»Ð¾Ð²Ð¾Ð¼: "Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾", "Ñ‡Ð°ÑÑ‚ÐºÐ¾Ð²Ð¾ Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾" Ð°Ð±Ð¾ "Ð½ÐµÐ¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾". ÐÐµ Ð´Ð¾Ð´Ð°Ð²Ð°Ð¹ Ð¿Ð¾ÑÑÐ½ÐµÐ½ÑŒ.
    """
                response = openai.ChatCompletion.create(
                    model="gpt-3.5-turbo",
                    messages=[
                        {"role": "system", "content": "Ð¢Ð¸ â€” ÐµÐºÑÐ¿ÐµÑ€Ñ‚ Ð· Ð¾Ñ†Ñ–Ð½ÐºÐ¸ ÐºÐ¾Ð¼ÑƒÐ½Ñ–ÐºÐ°Ñ†Ñ–Ð¹. Ð‘ÑƒÐ´ÑŒ Ð¾Ð±'Ñ”ÐºÑ‚Ð¸Ð²Ð½Ð¸Ð¼."},
                        {"role": "user", "content": evaluation_prompt}
                    ],
                    temperature=0.3,
                    max_tokens=50
                )
                raw_rating = response.choices[0].message["content"].strip().lower()

                # Ð’Ð¸Ñ‚ÑÐ³Ð½ÑƒÑ‚Ð¸ Ð¿ÐµÑ€ÑˆÐµ Ð·Ñ– ÑÐ»Ñ–Ð²: Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾, Ñ‡Ð°ÑÑ‚ÐºÐ¾Ð²Ð¾ Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾, Ð½ÐµÐ¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾
                match = re.search(r"(Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾|Ñ‡Ð°ÑÑ‚ÐºÐ¾Ð²Ð¾ Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾|Ð½ÐµÐ¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾)", raw_rating)
                rating = match.group(1) if match else "Ð½ÐµÐ¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾"
                
                if rating == "Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾":
                    objection_score = 5
                elif rating == "Ñ‡Ð°ÑÑ‚ÐºÐ¾Ð²Ð¾ Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾":
                    objection_score = 3
                elif rating == "Ð½ÐµÐ¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾":
                    objection_score = 0
                else:
                    objection_score = 0

                print(f"[SCORE] ÐžÑ†Ñ–Ð½ÐºÐ° Ð°Ñ€Ð³ÑƒÐ¼ÐµÐ½Ñ‚Ñ–Ð²: {rating} ({objection_score}/5 Ð±Ð°Ð»Ñ–Ð²)")

                model_score = session.get("model_score", 0)
                questions_score = sum(q["score"] for q in session.get("question_scores", []))
                answers_score = sum(a["score"] for a in session.get("user_answers", {}).values())
                total_score = model_score + questions_score + answers_score + objection_score
                max_score = 5 + 4 + 6 + 5

                print("\n=== Ð¤Ð†ÐÐÐ›Ð¬ÐÐ˜Ð™ Ð ÐÐ¥Ð£ÐÐžÐš ===")
                print(f"[SCORE] Ð—Ð° Ð¼Ð¾Ð´ÐµÐ»ÑŒ: {model_score}/4")
                print(f"[SCORE] Ð—Ð° Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ: {questions_score}/5")
                print(f"[SCORE] Ð—Ð° Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ–: {answers_score}/6")
                print(f"[SCORE] Ð—Ð° Ð·Ð°Ð¿ÐµÑ€ÐµÑ‡ÐµÐ½Ð½Ñ: {objection_score}/5")
                print(f"[SCORE] Ð—ÐÐ“ÐÐ›Ð¬ÐÐ˜Ð™ Ð‘ÐÐ›: {total_score}/20")

                if total_score >= max_score * 0.8:
                    feedback = "ðŸ” Ð§ÑƒÐ´Ð¾Ð²Ð¾! Ð’Ð¸ Ð´ÑƒÐ¶Ðµ Ð²Ð¿ÐµÐ²Ð½ÐµÐ½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÐ»Ð¸ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð° Ð´Ð¾ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸."
                elif total_score >= max_score * 0.6:
                    feedback = "ðŸ‘ Ð’Ð°ÑˆÑ– Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´Ñ– Ð±ÑƒÐ»Ð¸ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¸Ð¼Ð¸, Ð°Ð»Ðµ Ñ” Ð½Ð°Ð´ Ñ‡Ð¸Ð¼ Ð¿Ð¾Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸."
                else:
                    feedback = "âš ï¸ Ð„ Ð½ÐµÐ´Ð¾Ð»Ñ–ÐºÐ¸ Ð² Ð¿Ñ–Ð´Ñ…Ð¾Ð´Ñ– Ð´Ð¾ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°. Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÑ”Ñ‚ÑŒÑÑ Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ðµ Ð½Ð°Ð²Ñ‡Ð°Ð½Ð½Ñ."

                if rating == "Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾":
                    reply = "Ð’Ñ–Ñ‚Ð°ÑŽ, Ð’Ð¸ ÑƒÑÐ¿Ñ–ÑˆÐ½Ð¾ Ð¿Ñ€Ð¾ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚ÑƒÐ²Ð°Ð»Ð¸ ÐºÐ»Ñ–Ñ”Ð½Ñ‚Ð°."
                elif rating == "Ñ‡Ð°ÑÑ‚ÐºÐ¾Ð²Ð¾ Ð¿ÐµÑ€ÐµÐºÐ¾Ð½Ð»Ð¸Ð²Ð¾":
                    reply = "ÐšÐ»Ñ–Ñ”Ð½Ñ‚Ð° Ð±ÑƒÐ»Ð¾ Ð¿Ñ€Ð¾ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð¾Ð²Ð°Ð½Ð¾, Ð°Ð»Ðµ Ð´Ð¾Ð¿ÑƒÑ‰ÐµÐ½Ñ– Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ¸, Ñ‰Ð¾ Ð·Ð°Ð²Ð°Ð´Ð¸Ð»Ð¸ Ð½Ð°Ð±Ñ€Ð°Ñ‚Ð¸ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ñƒ ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ Ð±Ð°Ð»Ñ–Ð²."
                else:
                    reply = "ÐšÐ»Ñ–Ñ”Ð½Ñ‚ Ð½ÐµÐ·Ð°Ð´Ð¾Ð²Ð¾Ð»ÐµÐ½Ð¸Ð¹ ÐºÐ¾Ð½ÑÑƒÐ»ÑŒÑ‚Ð°Ñ†Ñ–Ñ”ÑŽ."

                full_reply = f"{reply}\n\nðŸ“Š Ð’Ð°ÑˆÐ° Ð¾Ñ†Ñ–Ð½ÐºÐ°: {total_score}/{max_score}\n{feedback}"

                # Ð—Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ Ð·Ð²Ñ–Ñ‚Ñƒ
                session["total_score"] = total_score
                report_content = generate_report(dict(session))
                report_filename = f"report_{session.get('seller_name', 'unknown')}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.txt"
                
                # Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð¿Ð°Ð¿ÐºÐ¸ reports, ÑÐºÑ‰Ð¾ Ñ—Ñ— Ð½ÐµÐ¼Ð°Ñ”
                os.makedirs('reports', exist_ok=True)
                
                send_email_report(
                    subject=f"Ð—Ð²Ñ–Ñ‚ Ð¿Ñ€Ð¾ Ð´Ñ–Ð°Ð»Ð¾Ð³ â€” {session.get('seller_name', 'ÐŸÑ€Ð¾Ð´Ð°Ð²ÐµÑ†ÑŒ')}",
                    body=report_content,
                    to_email="voloshchenko2014@gmail.com"
                )

                session.clear()
                session.modified = True

                return jsonify({
                    "reply": f"{full_reply}\n\nÐ—Ð²Ñ–Ñ‚ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð¾ Ð´Ð»Ñ Ð²Ð°ÑˆÐ¾Ð³Ð¾ Ñ‚Ñ€ÐµÐ½ÐµÑ€Ð°.",
                    "chat_ended": True,
                    "show_restart_button": True,
                    "report_filename": report_filename
                })
            
            except Exception as e:
                print(f"ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ†Ñ–Ð½ÑŽÐ²Ð°Ð½Ð½Ñ–: {str(e)}")
                return jsonify({
                    "reply": "Ð’Ð¸Ð±Ð°Ñ‡Ñ‚Ðµ, Ð½Ðµ Ð²Ð´Ð°Ð»Ð¾ÑÑ Ð¾Ð±Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ Ð²Ñ–Ð´Ð¿Ð¾Ð²Ñ–Ð´ÑŒ. Ð”Ð°Ð²Ð°Ð¹Ñ‚Ðµ ÑÐ¿Ñ€Ð¾Ð±ÑƒÑ”Ð¼Ð¾ Ñ‰Ðµ Ñ€Ð°Ð·?",
                    "chat_ended": False
                })

    return jsonify({
        "reply": "Ð’Ð¸Ð½Ð¸ÐºÐ»Ð° Ð½ÐµÐ¿ÐµÑ€ÐµÐ´Ð±Ð°Ñ‡ÐµÐ½Ð° Ð¿Ð¾Ð¼Ð¸Ð»ÐºÐ°. Ð¡Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ñ‰Ðµ Ñ€Ð°Ð·.",
        "chat_ended": True,
        "show_restart_button": True
    })
    
if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)